(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6957],{1889:(e,t,s)=>{"use strict";s.r(t),s.d(t,{persistenceService:()=>h});let r="undress_";function o(e,t,s=36e5){try{let o={value:t,expiresAt:Date.now()+s};localStorage.setItem(r+e,JSON.stringify(o))}catch(t){console.error(`Failed to save to localStorage: ${e}`,t)}}function i(e){try{let t=localStorage.getItem(r+e);if(!t)return null;let s=JSON.parse(t);if(Date.now()>s.expiresAt)return localStorage.removeItem(r+e),null;return s.value}catch(t){return console.error(`Failed to read from localStorage: ${e}`,t),null}}function n(e){try{localStorage.removeItem(r+e)}catch(t){console.error(`Failed to remove from localStorage: ${e}`,t)}}let a="persistent_state",c="active_generation",l="form_settings",d="images";class u{initialize(){try{let e=Object.keys(localStorage),t=Date.now();e.forEach(e=>{if(e.startsWith(r))try{let s=localStorage.getItem(e);if(!s)return;let r=JSON.parse(s);t>r.expiresAt&&localStorage.removeItem(e)}catch{localStorage.removeItem(e)}})}catch(e){console.error("Failed to clear expired items",e)}}saveState(e){o(a,{...e,savedAt:Date.now()},36e5)}loadState(){return i(a)}saveActiveGeneration(e){o(c,e,36e5)}loadActiveGeneration(){return i(c)}clearActiveGeneration(){n(c)}saveFormSettings(e){o(l,e,36e5)}loadFormSettings(){return i(l)}saveImages(e){o(d,e,36e5)}loadImages(){return i(d)}clearImages(){n(d)}clearAll(){n(a),n(c),n(l),n(d)}hasActiveGeneration(){let e=this.loadActiveGeneration();return null!==e&&"completed"!==e.status&&"failed"!==e.status}updateGenerationProgress(e,t,s){let r=this.loadActiveGeneration();if(!r)return;let o={...r,...void 0!==e&&{progress:e},...t&&{status:t},...void 0!==s&&{queuePosition:s},lastUpdate:Date.now()};this.saveActiveGeneration(o)}}let h=new u},2943:(e,t,s)=>{"use strict";s.d(t,{GK:()=>l,KN:()=>c,t4:()=>d,pE:()=>a});var r,o,i,n,a=((r={}).FREE="FREE",r.STARTER="STARTER",r.STARTER_3_MONTHS="STARTER_3_MONTHS",r.STARTER_YEARLY="STARTER_YEARLY",r.BASIC="BASIC",r.BASIC_3_MONTHS="BASIC_3_MONTHS",r.BASIC_YEARLY="BASIC_YEARLY",r.PREMIUM="PREMIUM",r.PREMIUM_3_MONTHS="PREMIUM_3_MONTHS",r.PREMIUM_YEARLY="PREMIUM_YEARLY",r.PREMIUM_FREE_TRIAL="PREMIUM_FREE_TRIAL",r),c=((o={}).GENERATE="textToImage",o.UNDRESS_IMAGE="undressImage",o.FACE_SWAP="faceSwap",o.DEEP_FAKE="deepFake",o.SWAP_BODY="swapBody",o.IMAGE_TO_VIDEO="imageToVideo",o.TEXT_TO_VIDEO="textToVideo",o),l=((i={}).RAMP="ramp",i.MERCURYO="mercuryo",i),d=((n={}).CREDITS="CREDITS",n.SUBSCRIPTION="SUBSCRIPTION",n)},14234:(e,t,s)=>{"use strict";s.d(t,{xU:()=>i,MR:()=>n,WD:()=>a});var r=s(50931),o=s(79114);let i="default",n=(0,r.Q_)();n.use(o.r9).init({fallbackLng:"en-US",ns:i,defaultNS:i,contextSeparator:"_c_",pluralSeparator:"_p_",nsSeparator:!1,keySeparator:!1,react:{useSuspense:!1,transSupportBasicHtmlNodes:!0}}),s(95155),s(12115);let a=()=>{let{t:e,i18n:t}=(0,o.Bd)(i,{i18n:n});return{t:e,i18n:t}}},34710:(e,t,s)=>{"use strict";s.d(t,{x:()=>o});var r=s(96830);let o=()=>{let{rootStore:e}=(0,r.g)();return e}},39838:(e,t,s)=>{"use strict";function r(e){switch(e){case 2:return 10;case 3:default:return 15;case 4:return 20;case 5:return 25;case 6:return 30;case 7:return 35}}s.d(t,{Do:()=>i,Yd:()=>n,j4:()=>r,jj:()=>o});let o=[{value:"512x512",label:"512\xd7512 (Square)",extraCredits:0,weight:0},{value:"704x480",label:"704\xd7480 (Landscape) (+5 credits)",extraCredits:5,weight:3},{value:"480x704",label:"480\xd7704 (Portrait) (+5 credits)",extraCredits:5,weight:3}],i=[{value:"blowjob",label:"Blowjob (15 credits)",weight:0},{value:"cumshot",label:"Cumshot (15 credits)",weight:3},{value:"sex_cut",label:"Sex Smash Cut (15 credits)",weight:3},{value:"oral_insertion",label:"Oral Insertion (15 credits)",weight:3},{value:"pov_insertion",label:"POV Insertion (15 credits)",weight:3},{value:"sex_fov_slider",label:"Cowgirl (FOV Slider) (15 credits)",weight:3},{value:"breast_insertion",label:"Paizuri/Boobjob (15 credits)",weight:3}],n=[{value:3,label:"3 seconds",credits:15,weight:0},{value:4,label:"4 seconds (+5 credits)",credits:20,weight:3},{value:5,label:"5 seconds (+10 credits)",credits:25,weight:3}]},50477:()=>{},70114:(e,t,s)=>{"use strict";s.d(t,{iD:()=>l,L4:()=>S,u7:()=>n,gy:()=>r.g});var r=s(96830);s(34710);var o=s(12115),i=s(73321);let n=()=>{let e=(0,i.useRouter)(),{rootStore:{routeStore:{setRouter:t}}}=(0,r.g)();(0,o.useEffect)(()=>{e&&t(e)},[e,t])};var a=s(77830),c=s.n(a);let l=()=>{let[e,t]=(0,o.useState)(!1),s=(0,o.useCallback)(e=>()=>{c()(e),t(!0)},[]);return(0,o.useEffect)(()=>{let s;return e&&(s=setTimeout(()=>t(!1),1e3)),()=>clearTimeout(s)},[e]),{isCopied:e,copyToClipboard:s}};var d=s(27866),u=s.n(d),h=s(53401),g=s.n(h);u().extend(g());let p=()=>{let e=u()().utc();return e.endOf("day").diff(e)/1e3},S=()=>{let[e,t]=(0,o.useState)(()=>Math.floor(p())),[s,r]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{if(!s)return;let e=setInterval(()=>{let s=Math.floor(p());t(s),s<=0&&(r(!1),clearInterval(e))},1e3);return()=>{clearInterval(e)}},[s]),{formattedTime:(e=>{if(e<0||isNaN(e))return{hours:"00",minutes:"00",seconds:"00"};let t=Math.floor(e/3600).toString().padStart(2,"0");return{hours:t,minutes:(Math.floor(e/60)%60).toString().padStart(2,"0"),seconds:(e%60).toFixed(0).padStart(2,"0")}})(e),timer:e,isPlaying:s,setIsPlaying:r}}},77258:(e,t,s)=>{"use strict";s.d(t,{JD:()=>m,yh:()=>S}),s(97630),s(86758);let r=/\.(heic|heif|HEIC|HEIF)$/,o=/image\/(hei(c|f)|x-heic|x-heif)/i,i="image/jpeg",n=e=>e?{name:e.name,type:e.type,size:e.size,lastModified:e.lastModified}:null,a=()=>{},c=e=>e?`${e.replace(/\.[^.]+$/,"")}.jpg`:"image.jpg",l=e=>new Promise((t,s)=>{let r=new FileReader;r.onload=()=>t(r.result??""),r.onerror=()=>s(r.error??Error("Failed to read blob.")),r.readAsDataURL(e)}),d=(e,t)=>{if(a(),"undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(e,t);let s=document.createElement("canvas");return s.width=e,s.height=t,s},u=async e=>e instanceof OffscreenCanvas?e.convertToBlob({type:i,quality:.92}):new Promise((t,s)=>{e.toBlob(e=>{e?t(e):s(Error("Canvas toBlob returned null."))},i,.92)}),h=async e=>{if(a(),"createImageBitmap"in window)try{let t=await createImageBitmap(e);return{source:t,width:t.width,height:t.height,cleanup:()=>t.close()}}catch(e){console.warn("[resizeImage] createImageBitmap failed, falling back to Image()",e)}let t=await l(e),s=await new Promise((e,s)=>{let r=new Image;r.crossOrigin="anonymous",r.decoding="async",r.onload=()=>e(r),r.onerror=e=>s(e instanceof ErrorEvent?e.error:e),r.src=t});return{source:s,width:s.naturalWidth||s.width,height:s.naturalHeight||s.height,cleanup:()=>{s.src=""}}},g=async e=>{let{source:t,width:s,height:r,cleanup:o}=await h(e);try{let o=Math.max(s,r)||1,n=Math.min(1,1024/o),a=Math.max(1,Math.round(s*n)),h=Math.max(1,Math.round(r*n)),g=d(a,h),p=g.getContext("2d");if(!p)throw Error("Failed to acquire 2D canvas context.");p.imageSmoothingEnabled=!0,p.imageSmoothingQuality="high",p.clearRect(0,0,a,h),p.drawImage(t,0,0,a,h);let S=await u(g),m=new File([S],c(e.name),{type:i,lastModified:Date.now()});return{base64:await l(m),resizedFile:m}}finally{o?.()}},p=async e=>{if(console.log("[resizeImage] Converting HEIC to JPEG (client)",n(e)),!e||0===e.size)throw Error("Invalid or empty HEIC file");let t=async()=>{let t=await s.e(8096).then(s.t.bind(s,15079,23)),r=t.default??t,o=await r({blob:e,toType:i,quality:1}),a=new File([Array.isArray(o)?o[0]:o],c(e.name),{type:i,lastModified:Date.now()});return console.log("[resizeImage] heic2any conversion complete",{original:n(e),converted:n(a)}),a},r=async()=>{let t=await Promise.all([s.e(8096),s.e(3416)]).then(s.t.bind(s,69460,23)),r=t.default??t,o=await e.arrayBuffer(),a=await r({buffer:new Uint8Array(o)}),l=d(a.width,a.height),h=l.getContext("2d");if(!h)throw Error("Failed to create canvas context for HEIC decode.");let g=h.createImageData(a.width,a.height);g.data.set(a.data),h.putImageData(g,0,0);let p=new File([await u(l)],c(e.name),{type:i,lastModified:Date.now()});return console.log("[resizeImage] heic-decode conversion complete",{original:n(e),converted:n(p)}),p},o=[];try{return await t()}catch(t){console.warn("[resizeImage] heic2any conversion failed, trying heic-decode",{original:n(e),error:t}),o.push(t)}try{return await r()}catch(t){console.error("[resizeImage] heic-decode conversion failed",{original:n(e),error:t}),o.push(t)}let a=Error("Unable to convert this HEIC image in the browser. Please export it as JPG or PNG and try again.");throw a.details=o,a},S=async e=>{let t=n(e),s="undefined"!=typeof performance?performance.now():Date.now();console.log("[resizeImage] received file",t);try{let i=e;(o.test(e.type)||r.test(e.name))&&(i=await p(e));let{base64:a,resizedFile:c}=await g(i),l="undefined"!=typeof performance?performance.now():Date.now();return console.log("[resizeImage] success",{original:t,processed:n(c),durationMs:Math.round(l-s),resultLength:a.length}),a}catch(e){throw console.error("[resizeImage] failed",{meta:t,error:e}),e instanceof Error?e:Error("Failed to process image. Please try again.")}};function m(e){let t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",new Date().getTime().toString()+".jpeg"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}s(7351),s(41463),s(2943)},82114:(e,t,s)=>{var r={"./en-US/default.json":[50247,247],"./uk-UA/default.json":[1672,1672]};function o(e){if(!s.o(r,e))return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=r[e],o=t[0];return s.e(t[1]).then(()=>s.t(o,19))}o.keys=()=>Object.keys(r),o.id=82114,e.exports=o},83599:(e,t,s)=>{"use strict";s.d(t,{F0:()=>i,H_:()=>o,Oe:()=>l,VZ:()=>u,Vc:()=>c,aD:()=>r,cg:()=>g,g4:()=>d,if:()=>n,vC:()=>a,wV:()=>h});let r="/#start",o="/",i="/auth",n="/admin",a="/undress",c="/plans",l="/profile",d="/affiliate",u="/deepnude-alternative-2025",h="/terms",g="/privacy"},94432:(e,t,s)=>{"use strict";s.d(t,{$n:()=>u,FN:()=>S.Carousel,Wk:()=>S.CarouselContent,A7:()=>S.CarouselItem,Oj:()=>S.CarouselNext,Q8:()=>S.CarouselPrevious,lG:()=>b.Dialog,Cf:()=>b.DialogContent,rr:()=>b.DialogDescription,Es:()=>b.DialogFooter,c7:()=>b.DialogHeader,L3:()=>b.DialogTitle,K0:()=>r.K,pd:()=>R,JU:()=>y.Label,l6:()=>m.Select,gC:()=>m.SelectContent,eb:()=>m.SelectItem,bq:()=>m.SelectTrigger,yv:()=>m.SelectValue,tU:()=>v.Tabs,j7:()=>v.TabsList,Xi:()=>v.TabsTrigger,TM:()=>I,m_:()=>f.Tooltip,ZI:()=>f.TooltipContent,Bc:()=>f.TooltipProvider,k$:()=>f.TooltipTrigger});var r=s(99057),o=s(95155),i=s(40980),n=s(42442),a=s(12115),c=s(18460),l=s(98522);let d=(0,c.F)("text-lg font-semibold leading-none relative text-bt flex flex-nowrap items-center justify-center gap-2 whitespace-nowrap rounded-[100px] border-0 px-6 py-2 normal-case ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{primary:"bg-pM hover:bg-p2 active:bg-p3 disabled:bg-p4 text-black ",secondary:"bg-transparent border border-pM text-pM hover:bg-p4 active:bg-p2 active:text-p4 disabled:bg-transparent disabled:border-p4 disabled:text-p4",inverted:"bg-black text-pM hover:bg-g4 active:bg-g3 disabled:bg-g3 disabled:text-g2",outline:"bg-transparent border border-g4 text-white hover:border-g3 hover:bg-g4/50 active:border-g3 active:bg-g4/80 disabled:border-g4 disabled:text-g3"},size:{default:"h-[54px] px-6 py-2 min-w-[172px]",icon:"h-10 w-10"}},defaultVariants:{variant:"primary",size:"default"}}),u=(0,a.forwardRef)(({className:e,variant:t="primary",size:s,asChild:r=!1,loading:a,children:c,onClick:u,...h},g)=>{let p=r?n.DX:"button";return(0,o.jsx)(p,{className:(0,i.cn)(d({variant:t,size:s,className:e})),onClick:a||h.disabled?void 0:u,ref:g,...h,children:a?(0,o.jsx)(l.default,{size:8,color:"primary"===t?"#121417":"#DBFF00"}):c})});u.displayName="Button";var h=s(98500),g=s.n(h);let p=(0,c.F)("relative flex flex-1 flex-nowrap items-center justify-center gap-2 whitespace-nowrap rounded-[100px] border-0 px-4 py-1 normal-case ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"text-bt text-white"},size:{default:""}},defaultVariants:{variant:"default",size:"default"}});(0,a.forwardRef)(({className:e,variant:t,size:s,asChild:r=!1,href:a,children:c,...l},d)=>{let u=(0,i.cn)(p({variant:t,size:s,className:e}));if(a)return(0,o.jsx)(g(),{href:a,className:u,...l,children:c});let h=r?n.DX:"button";return(0,o.jsx)(h,{className:u,ref:d,...l,children:c})}).displayName="TextButton";var S=s(32169);a.forwardRef(({className:e,...t},s)=>(0,o.jsx)("div",{ref:s,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t})).displayName="Card",a.forwardRef(({className:e,...t},s)=>(0,o.jsx)("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...t})).displayName="CardHeader",a.forwardRef(({className:e,...t},s)=>(0,o.jsx)("h3",{ref:s,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",e),...t})).displayName="CardTitle",a.forwardRef(({className:e,...t},s)=>(0,o.jsx)("p",{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",e),...t})).displayName="CardDescription",a.forwardRef(({className:e,...t},s)=>(0,o.jsx)("div",{ref:s,className:(0,i.cn)("p-6 pt-0",e),...t})).displayName="CardContent",a.forwardRef(({className:e,...t},s)=>(0,o.jsx)("div",{ref:s,className:(0,i.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter",s(927);var m=s(29991);let I=a.forwardRef(({className:e,...t},s)=>(0,o.jsx)("textarea",{className:(0,i.cn)("text-sm flex min-h-[108px] w-full rounded-[16px] border-input bg-g4 px-4 py-3 ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));I.displayName="Textarea";var v=s(47687),y=s(33807);s(32777);var f=s(70872);let R=a.forwardRef(({className:e,type:t,...s},r)=>(0,o.jsx)("input",{type:t,className:(0,i.cn)("text-sm flex w-full rounded-[16px] border-input bg-g4 px-4 py-3 ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...s}));R.displayName="Input";var b=s(42763);s(94179)},96830:(e,t,s)=>{"use strict";s.d(t,{g:()=>Y});var r=s(12115),o=s(88074);class i{constructor(e=!1,t=!1,s=!1){this.loading=e,this.success=t,this.error=s}}class n{constructor(){this._asyncStatusMap=new Map,this._asyncErrorsMap=new Map,(0,o.Gn)(this,{_asyncStatusMap:o.sH,_asyncErrorsMap:o.sH,setLoading:o.XI.bound,setSuccess:o.XI.bound,setError:o.XI.bound,createKey:o.XI.bound,resetAsyncStatus:o.XI.bound})}hasKey(e){return this._asyncStatusMap.has(e)}createKey(e){let t=Symbol(e);return this._asyncStatusMap.set(t,new i(!1,!1,!1)),t}getAsyncStatus(e){return this.hasKey(e),this._asyncStatusMap.get(e)}getAsyncError(e){return this.hasKey(e),this._asyncErrorsMap.get(e)}resetAsyncStatus(e){this.hasKey(e),this._asyncStatusMap.set(e,new i(!1,!1,!1))}setLoading(e){this.hasKey(e),this._asyncErrorsMap.delete(e),this._asyncStatusMap.set(e,new i(!0,!1,!1))}setSuccess(e){this.hasKey(e),this._asyncErrorsMap.delete(e),this._asyncStatusMap.set(e,new i(!1,!0,!1))}setError(e,t){this.hasKey(e),t?this._asyncErrorsMap.set(e,t):this._asyncErrorsMap.delete(e),this._asyncStatusMap.set(e,new i(!1,!1,!0))}}class a extends n{constructor(e){super(),this.rootStore=e,(0,o.Gn)(this,{rootStore:o.sH})}}var c=s(59185);class l{constructor(e){this.instance=e}authWithGoogle({code:e}){return this.instance.get(`/google/redirect?code=${e}`)}restoreAccount({token:e}){return this.instance.post("/auth/restore",{token:e})}logout(){return this.instance.post("/auth/logout")}}var d=s(36578);class u{constructor(e){this.instance=e}getMe(){return this.instance.get("/me").then(({data:e})=>e)}updateMe(e){return this.instance.post("/me",e)}getRefCode(){return this.instance.get("/ref").then(({data:e})=>e)}deleteAccount(){return this.instance.delete("/me").then(({data:e})=>e)}requestWithdraw(e){return this.instance.post("/withdraw",e)}setRefCode(e){return this.instance.post(`/ref?${d.A.stringify({ref:e})}`)}getRefStats(e){return this.instance.get(`/admin/refStats/${e}`).then(({data:e})=>e)}getRefCodes(){return this.instance.get("/admin/refCodes").then(({data:e})=>e)}clearAdminImages(e){let t="number"==typeof e&&Number.isFinite(e)?`?${d.A.stringify({months:e})}`:"";return this.instance.get(`/admin/clearImages${t}`).then(({data:e})=>e)}updateUserDiscount(e){return this.instance.patch("/admin/user/discount",e).then(({data:e})=>e)}getPaymentLink(e){return this.instance.post("/apay/create-payment-link",{subscriptionType:e}).then(({data:e})=>e)}getCryptoPaymentLink(e,t,s){return this.instance.post("/crypto/create-payment-link",{subscriptionType:e,isRenewCredits:t,provider:s}).then(({data:e})=>e)}getDimondPaymentLink(e,t){return this.instance.post("/dimond/create-payment-link",{subscriptionType:e,isRenewCredits:t}).then(({data:e})=>e)}createSubscription(e){return this.instance.post("/payment-net/create-subscription",{subscriptionType:e}).then(({data:e})=>e)}createPaymentLink(e,t=!1){return this.instance.post("/voltpay/create-payment",{subscriptionType:e,isRenewCredits:t}).then(({data:e})=>e)}generateCryptoAddress(e,t=!1){return this.instance.post("/crypto/create-crypto-address",{subscriptionType:e,isRenewCredits:t}).then(({data:e})=>e)}schedulePaymentFollowUp(){return this.instance.post("/payment-follow-up").then(()=>void 0)}getSubscription(){return this.instance.get("/subscription/me").then(({data:e})=>e)}getDashboardSubscription(){return this.instance.get("/dashboard/subscriptions").then(({data:e})=>e)}getCancelSubscriptionUrl(){return this.instance.get("/subscription/cancel-url").then(({data:e})=>e)}cancelSubscription(e){return this.instance.post("/subscription/cancel",{reason:e}).then(({data:e})=>e)}}class h{constructor(e){this.instance=e}async undressImage(){return this.instance.post("/undress")}}var g=s(91010),p=s(81694),S=s.n(p),m=s(30069);class I{async initialize(){return this.fingerprint?this.fingerprint:(this.initPromise||(this.initPromise=this.generateFingerprint().then(e=>(this.fingerprint=e,this.initPromise=null,console.log("[FingerprintService] Initialized:",e.substring(0,8)+"..."),e)).catch(e=>(console.error("[FingerprintService] Failed to initialize:",e),this.initPromise=null,this.fingerprint=this.generateFallbackFingerprint(),this.fingerprint))),this.initPromise)}getFingerprint(){return this.fingerprint||(console.warn("[FingerprintService] Not initialized, using fallback"),this.fingerprint=this.generateFallbackFingerprint()),this.fingerprint}async generateFingerprint(){let e=JSON.stringify({userAgent:navigator.userAgent,language:navigator.language,languages:navigator.languages.join(","),platform:navigator.platform,hardwareConcurrency:navigator.hardwareConcurrency||0,deviceMemory:navigator.deviceMemory||0,maxTouchPoints:navigator.maxTouchPoints||0,vendor:navigator.vendor,screenWidth:screen.width,screenHeight:screen.height,screenColorDepth:screen.colorDepth,screenPixelDepth:screen.pixelDepth,screenAvailWidth:screen.availWidth,screenAvailHeight:screen.availHeight,timezoneOffset:new Date().getTimezoneOffset(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,cookieEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack||"unspecified",canvas:await this.getCanvasFingerprint()});return await this.hashString(e)}generateFallbackFingerprint(){let e=[navigator.userAgent,navigator.language,`${screen.width}x${screen.height}x${screen.colorDepth}`,new Date().getTimezoneOffset().toString(),navigator.platform,navigator.vendor,(navigator.hardwareConcurrency||0).toString()].join("|"),t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t&=t;return"fb_"+Math.abs(t).toString(36)}async getCanvasFingerprint(){try{let e=document.createElement("canvas");e.width=200,e.height=50;let t=e.getContext("2d");if(!t)return"no-canvas";t.textBaseline="top",t.font="14px Arial",t.fillStyle="#f60",t.fillRect(0,0,100,50),t.fillStyle="#069",t.fillText("DeviceID",2,15);let s=e.toDataURL();return await this.hashString(s)}catch(e){return"canvas-error"}}async hashString(e){try{let t=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("").substring(0,32)}catch(e){return this.generateFallbackFingerprint()}}clear(){this.fingerprint=null,this.initPromise=null}constructor(){this.fingerprint=null,this.initPromise=null}}let v=new I;class y{constructor(e,t,s){this.http=e,this.url=t,this.path=s,this.socket=null,this.secret=null,this.secretPromise=null,this.pendingRequests=new Map,this.connectionListeners=new Set,this.connectionState="connecting",this.listenersBound=!1,this.forceReconnection=!1,this.pendingGenerationsModule=null,this.pendingGenerationsLoadPromise=null,this.handleConnect=()=>{this.setConnectionState("connected"),this.checkPendingGenerations()},this.handleDisconnect=e=>{let t=this.extractMessage(e)??"Socket disconnected";if(this.secret=null,this.rejectAllPending({reason:"socket_disconnected",message:t}),this.clearAllPendingGenerations(),this.forceReconnection){this.forceReconnection=!1,this.socket?.active||this.socket?.connect();return}this.setConnectionState("disconnected",{reason:t}),setTimeout(()=>{this.socket?.connected||this.socket?.connect()},500)},this.handleConnectError=e=>{let t=e instanceof Error?e:Error("Socket connection failed");this.setConnectionState("error",{error:t}),this.rejectAllPending({reason:"socket_connection_failed",message:t.message}),this.clearAllPendingGenerations()},this.handleReconnectAttempt=e=>{this.setConnectionState("reconnecting",{attempt:e})},this.handleReconnectFailed=()=>{this.setConnectionState("error",{reason:"reconnect_failed",error:Error("Socket reconnection failed")})},this.handleResult=e=>{let t=e?.requestId;if(!t||(this.removePendingGeneration(t),this.sendResultConfirmation(t).catch(e=>{console.error("[SocketService] Failed to confirm result:",e)}),!this.pendingRequests.has(t)))return;if(!e.base64Image&&!e.payload&&!e.videoUrl)return void this.rejectPendingRequest(t,{reason:"empty_response"});let s=e.videoUrl?e:e.base64Image??e.payload;this.resolvePendingRequest(t,s)},this.handleServerError=e=>{let t=e?.requestId;t&&(this.removePendingGeneration(t),this.pendingRequests.has(t))?this.rejectPendingRequest(t,e):this.rejectAllPending(e??{reason:"socket_error",message:"Unexpected socket error"})},this.handleProgressEvent=e=>{let t=e?.requestId;if(!t)return;"string"==typeof e?.externalRequestId&&this.setPendingExternalRequestId(t,e.externalRequestId);let s="number"==typeof e?.progress&&Number.isFinite(e.progress)?e.progress:void 0,r="number"==typeof e?.queuePosition?e.queuePosition:void 0,o="string"==typeof e?.status?e.status:void 0;(void 0!==s||o)&&this.updatePendingGenerationProgress(t,s??0,o,r)},this.handleCancellationEvent=e=>{let t=e?.requestId;t&&("string"==typeof e?.externalRequestId&&this.setPendingExternalRequestId(t,e.externalRequestId),this.removePendingGeneration(t))},this.handleRequestAccepted=e=>{let t=e?.requestId;if(!t)return;let s=this.pendingRequests.get(t);s?.onAccepted?.({requestId:t}),"string"==typeof e?.externalRequestId&&this.setPendingExternalRequestId(t,e.externalRequestId)},this.handleConfirmationAck=e=>{let t=e?.requestId;t&&console.log("[SocketService] Confirmation acknowledged | requestId:",t)}}initialize(){this.socket||(this.socket=(0,m.Ay)(this.url,{path:this.path,transports:["websocket"],reconnection:!0,reconnectionDelay:500,reconnectionAttempts:999,withCredentials:!0}),this.setConnectionState("connecting"),this.bindSocketListeners())}onConnectionStateChange(e){return this.connectionListeners.add(e),e(this.connectionState),()=>{this.connectionListeners.delete(e)}}getConnectionState(){return this.connectionState}async sendMessage(e,t,s){await this.ensureSocketConnected();let r=await this.getSecret();return new Promise((o,i)=>{let n=t.requestId||(0,g.A)(),a={message:{...t,requestId:n,deviceFingerprint:v.getFingerprint()},id:n},c=JSON.stringify(a),l=S()(c,r).toString(),d=()=>{let e=this.pendingRequests.get(n);e&&(clearTimeout(e.timeoutId),this.pendingRequests.delete(n))},u={resolve:e=>{d(),o({requestId:n,payload:e})},reject:e=>{d(),i(this.enrichError(e,n))},onAccepted:s?.onRequestAccepted,timeoutId:setTimeout(()=>{},0x3b9ac9ff)};if(this.pendingRequests.set(n,u),s?.onRequestCreated?.(n),!this.socket)return void this.rejectPendingRequest(n,"Socket unavailable");if(!this.socket.connected){this.rejectPendingRequest(n,{reason:"socket_disconnected",message:"Socket disconnected before request was sent"}),this.socket.active||this.socket.connect();return}this.socket.emit(e,{...a,signature:l})})}subscribe(e,t){this.socket?.on(e,t)}async emit(e,t){await this.ensureSocketConnected();let s=await this.getSecret(),r=t.requestId||(0,g.A)(),o={message:{...t,requestId:r,deviceFingerprint:v.getFingerprint()},id:r},i=JSON.stringify(o),n=S()(i,s).toString();if(!this.socket||!this.socket.connected)throw Error("Socket not connected");this.socket.emit(e,{...o,signature:n})}reconnect(){if(this.initialize(),this.socket){if(this.forceReconnection=!0,this.setConnectionState("reconnecting"),this.socket.connected)return void this.socket.disconnect();this.socket.active||this.socket.connect()}}bindSocketListeners(){this.socket&&!this.listenersBound&&(this.listenersBound=!0,this.socket.on("connect",this.handleConnect),this.socket.on("disconnect",this.handleDisconnect),this.socket.on("connect_error",this.handleConnectError),this.socket.on("result",this.handleResult),this.socket.on("error",this.handleServerError),this.socket.on("requestAccepted",this.handleRequestAccepted),this.socket.on("progress",this.handleProgressEvent),this.socket.on("cancelled",this.handleCancellationEvent),this.socket.on("confirmation.ack",this.handleConfirmationAck),this.socket.io.on("reconnect_attempt",this.handleReconnectAttempt),this.socket.io.on("reconnect_failed",this.handleReconnectFailed))}checkPendingGenerations(){try{s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:e})=>{let t=e.getAll();t.length>0&&(console.log(`[SocketService] Found ${t.length} pending generation(s), emitting recovery event`),this.socket?.emit("recovery:check",{pendingGenerations:t.map(e=>({requestId:e.requestId,type:e.type,...e.externalRequestId?{externalRequestId:e.externalRequestId}:{}}))}),t.forEach(e=>{this.socket&&this.socket.emit("internal:recover",e)}))}).catch(e=>{console.error("[SocketService] Failed to check pending generations:",e)})}catch(e){console.error("[SocketService] Error in checkPendingGenerations:",e)}}resolvePendingRequest(e,t){let s=this.pendingRequests.get(e);s?.resolve(t)}rejectPendingRequest(e,t){let s=this.pendingRequests.get(e);s?.reject(t)}rejectAllPending(e){this.pendingRequests.size&&Array.from(this.pendingRequests.keys()).forEach(t=>this.rejectPendingRequest(t,e))}async ensureSocketConnected(){if(this.initialize(),!this.socket)throw Error("Socket not initialised");this.socket.connected||(this.setConnectionState("connecting"),await new Promise((e,t)=>{if(!this.socket)return void t(Error("Socket not initialised"));let s=()=>{this.socket?.off("connect",r),this.socket?.off("connect_error",o),this.socket?.off("error",o),clearTimeout(i)},r=()=>{s(),e()},o=e=>{s(),t(e instanceof Error?e:Error("Socket connection failed"))},i=setTimeout(()=>{s(),t(Error("Socket connection timeout"))},1e4);this.socket.once("connect",r),this.socket.once("connect_error",o),this.socket.once("error",o),this.socket.active||this.socket.connect()}))}async getSecret(){let e=Date.now();return this.secret&&this.secret.expiresAt-2e3>e?this.secret.key:(this.secretPromise||(this.secretPromise=this.http.post("/socket/secret").then(({data:e})=>{if(!e?.key||"string"!=typeof e.key)throw Error("Invalid socket secret response");let t=Number(e?.expiresInMs??0);if(!Number.isFinite(t)||t<=0)throw Error("Invalid socket secret expiration");return this.secret={key:e.key,expiresAt:Date.now()+t},e.key}).catch(e=>{throw this.secret=null,e}).finally(()=>{this.secretPromise=null})),this.secretPromise)}setConnectionState(e,t){let s=this.connectionState!==e,r=s||t?.attempt!==void 0;s&&(this.connectionState=e),r&&this.connectionListeners.forEach(s=>s(e,t))}enrichError(e,t){if(e instanceof Error)return e.requestId=t,e;if(e&&"object"==typeof e)return{requestId:t,...e};let s=Error("string"==typeof e?e:"Socket error");return s.requestId=t,s}async getPendingGenerationsModule(){return this.pendingGenerationsModule?this.pendingGenerationsModule:(this.pendingGenerationsLoadPromise||(this.pendingGenerationsLoadPromise=s.e(2352).then(s.bind(s,52352)).then(e=>(this.pendingGenerationsModule=e,this.pendingGenerationsLoadPromise=null,e)).catch(e=>{throw console.error("[SocketService] Failed to load PendingGenerationsService:",e),this.pendingGenerationsLoadPromise=null,e})),this.pendingGenerationsLoadPromise)}async setPendingExternalRequestId(e,t){if(e&&t)try{(await this.getPendingGenerationsModule()).PendingGenerationsService.setExternalRequestId(e,t)}catch(e){console.error("[SocketService] Failed to store external request id:",e)}}async updatePendingGenerationProgress(e,t,s,r){if(e)try{(await this.getPendingGenerationsModule()).PendingGenerationsService.updateProgress(e,t,s,r)}catch(e){console.error("[SocketService] Failed to update pending generation progress:",e)}}async removePendingGeneration(e){if(e)try{(await this.getPendingGenerationsModule()).PendingGenerationsService.remove(e)}catch(e){console.error("[SocketService] Failed to remove pending generation:",e)}}extractMessage(e){if(e){if("string"==typeof e)return e;if(e instanceof Error)return e.message;if("object"==typeof e&&"message"in e){let t=e.message;return"string"==typeof t?t:void 0}}}async sendResultConfirmation(e){try{await this.emit("result.confirm",{requestId:e}),console.log("[SocketService] Result confirmed | requestId:",e)}catch(e){throw console.error("[SocketService] Failed to send confirmation:",e),e}}clearAllPendingGenerations(){try{s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:e})=>{let t=e.getAll();t.length>0&&(console.log(`[SocketService] Clearing ${t.length} pending generation(s) due to socket error`),e.clearAll())}).catch(e=>{console.error("[SocketService] Failed to clear pending generations:",e)})}catch(e){console.error("[SocketService] Error in clearAllPendingGenerations:",e)}}}class f{constructor(e){this.instance=e}applyPromoCode(e){return this.instance.post("/promocodes/apply",{code:e}).then(({data:e})=>e)}getUserPromoCodes(){return this.instance.get("/promocodes/user/history").then(({data:e})=>e)}listRefCodes(){return this.instance.get("/promocodes/ref-codes").then(({data:e})=>e)}listPromoCodes(){return this.instance.get("/promocodes").then(({data:e})=>e.map(e=>({id:e.id,code:e.code,rewardType:e.rewardType,creditAmount:e.creditAmount??0,discountPercentage:e.discountPercentage??0,subscriptionType:e.subscriptionType??null,subscriptionDurationDays:e.subscriptionDurationDays??null,maxUses:e.maxUses??null,isActive:e.isActive,expiresAt:e.expiresAt??null,description:e.description??null,createdAt:e.createdAt,usagesCount:e._count?.usages??0})))}createPromoCode(e){return this.instance.post("/promocodes",e).then(({data:e})=>({id:e.id,code:e.code,rewardType:e.rewardType,creditAmount:e.creditAmount??0,discountPercentage:e.discountPercentage??0,subscriptionType:e.subscriptionType??null,subscriptionDurationDays:e.subscriptionDurationDays??null,maxUses:e.maxUses??null,isActive:e.isActive,expiresAt:e.expiresAt??null,description:e.description??null,createdAt:e.createdAt,usagesCount:0}))}}class R{constructor(e){this.httpService=e}async checkStatus(e){try{return(await this.httpService.get(`/api/generation/status/${e}`)).data}catch(e){if(e.response?.status===404)return{status:"FAILED",error:"Generation request not found"};throw e}}async resumeGeneration(e){try{await this.httpService.post(`/api/generation/resume/${e}`)}catch(e){throw console.error("Failed to resume generation:",e),e}}}class b{constructor(){this.instance=c.A.create({baseURL:"https://api.undress.zone",withCredentials:!0}),this.authService=new l(this.instance),this.userService=new u(this.instance),this.undressService=new h(this.instance),this.socketService=new y(this.instance,"wss://api.undress.zone","/socket.io"),this.promoCodeService=new f(this.instance),this.generationStatusService=new R(this.instance)}}var q=s(2943),C=s(77258);class A{constructor(){this.backendUrl="https://api.undress.zone"}async requestUploadUrl(e){let t=e.name.split(".").pop()||"png",s=e.type||"image/png";console.log("[UploadService] Requesting presigned URL:",{backendUrl:this.backendUrl,fileName:e.name,fileExtension:t,contentType:s,fileSize:e.size});let r=await fetch(`${this.backendUrl}/upload/request-url`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({fileExtension:t,contentType:s})});if(console.log("[UploadService] Presigned URL response:",{status:r.status,statusText:r.statusText,ok:r.ok}),!r.ok){let e=await r.json().catch(()=>({}));throw console.error("[UploadService] Failed to get presigned URL:",e),Error(e.message||`Failed to get upload URL: ${r.statusText}`)}let o=await r.json();return console.log("[UploadService] Presigned URL received:",{s3Key:o.s3Key,uploadUrlLength:o.uploadUrl?.length,publicUrl:o.publicUrl,expiresAt:o.expiresAt}),o}async uploadToS3(e,t,s){return console.log("[UploadService] Starting DIRECT upload to S3/R2:",{fileName:e.name,fileType:e.type,fileSize:e.size,uploadUrl:t.substring(0,100)+"..."}),new Promise((r,o)=>{let i=new XMLHttpRequest;i.upload.addEventListener("progress",e=>{if(e.lengthComputable&&s){let t=e.loaded/e.total*100;console.log(`[UploadService] Upload progress: ${t.toFixed(1)}%`),s(t)}}),i.addEventListener("load",()=>{i.status>=200&&i.status<300?(console.log("[UploadService] S3 upload successful!",{status:i.status,statusText:i.statusText}),r()):(console.error("[UploadService] S3 upload failed:",{status:i.status,statusText:i.statusText,response:i.responseText}),o(Error(`S3 upload failed: ${i.statusText}`)))}),i.addEventListener("error",()=>{console.error("[UploadService] S3 upload network error"),o(Error("Network error during S3 upload"))}),i.addEventListener("abort",()=>{console.error("[UploadService] S3 upload aborted"),o(Error("Upload aborted"))}),i.open("PUT",t),i.setRequestHeader("Content-Type",e.type),i.setRequestHeader("Content-Disposition","inline"),i.send(e)})}async uploadImage(e,t){console.log("[UploadService] Starting uploadImage:",{fileName:e.name,fileType:e.type,fileSize:e.size,hasProgressCallback:!!t});try{console.log("[UploadService] Step 1: Requesting presigned URL..."),t&&t(10);let{uploadUrl:s,publicUrl:r}=await this.requestUploadUrl(e);return console.log("[UploadService] Step 2: Uploading DIRECTLY to S3..."),await this.uploadToS3(e,s,e=>{t&&t(30+.7*e)}),console.log("[UploadService] Step 3: Upload complete!",{publicUrl:r}),t&&t(100),r}catch(e){throw console.error("[UploadService] Upload failed:",{error:e,message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0}),e}}validateFile(e,t){let s=t?.maxSizeMB||10,r=t?.allowedTypes||["image/png","image/jpeg","image/jpg","image/webp"],o=e.size/1048576;return o>s?{valid:!1,error:`File size (${o.toFixed(1)}MB) exceeds maximum allowed size (${s}MB)`}:r.includes(e.type)?{valid:!0}:{valid:!1,error:`File type ${e.type} is not allowed. Allowed types: ${r.join(", ")}`}}}let w=new A;var P=s(1889);let E=e=>e?{name:e.name,type:e.type,size:e.size,lastModified:e.lastModified}:null;class k extends a{constructor(e){super(e),this.currentImage=null,this.currentMode=q.KN.UNDRESS_IMAGE,this.outputType="image",this.undressedImage=null,this.uploadedImage=null,this.uploadedFaceImage=null,this.activeRequestId=null,this.lastRequestId=null,this.isRequestAccepted=!1,this.uploadImageError=!1,this.serverError=!1,this.serverErrorCount=0,this.socketState="connecting",this.socketMessage=null,this.persistentError=null,this.lastRequestTime=0,this.minRequestInterval=2e3,this.asyncStatuses={startStableJob:this.createKey("startStableJob"),undressCheck:this.createKey("undressCheck"),uploadBodyImage:this.createKey("uploadBodyImage"),uploadFaceImage:this.createKey("uploadFaceImage")},(0,o.Gn)(this,{currentImage:o.sH,uploadedImage:o.sH,resetCurrentImage:o.XI.bound,startStableJob:o.XI.bound,startStableJobStatus:o.EW,uploadImage:o.XI.bound,uploadImageError:o.sH,setUploadImageError:o.XI.bound,resetUndressedImage:o.XI.bound,undressedImage:o.sH,undressCheck:o.XI.bound,undressCheckStatus:o.EW,serverError:o.sH,serverErrorCount:o.sH,socketState:o.sH,socketMessage:o.sH,persistentError:o.sH,clearPersistentError:o.XI.bound,setPersistentError:o.XI.bound,setMode:o.XI.bound,currentMode:o.sH,outputType:o.sH,setOutputType:o.XI.bound,uploadedFaceImage:o.sH,uploadFaceImage:o.XI.bound,resetFaceImage:o.XI.bound,resetImage:o.XI.bound,activeRequestId:o.sH,lastRequestId:o.sH,isRequestAccepted:o.sH,uploadBodyStatus:o.EW,uploadFaceStatus:o.EW,handleRequestAccepted:o.XI.bound,handleProgress:o.XI.bound,handleComplete:o.XI.bound,handleError:o.XI.bound}),this.rootStore.requester.socketService.onConnectionStateChange((e,t)=>{(0,o.h5)(()=>{this.socketState=e,this.socketMessage=this.buildSocketMessage(e,t),"connected"===e&&(this.serverError=!1,this.serverErrorCount=0)})}),this.initializePersistence(),this.setupPersistenceReactions(),this.setupSocketListeners()}setupSocketListeners(){try{let e=this.rootStore.requester?.socketService;if(!e){console.warn("[AIStore] Socket service not available yet, retrying..."),setTimeout(()=>this.setupSocketListeners(),100);return}e.subscribe("requestAccepted",this.handleRequestAccepted),e.subscribe("progress",this.handleProgress),e.subscribe("result",this.handleComplete),e.subscribe("error",this.handleError),console.log("[AIStore] Subscribed to socket events: requestAccepted, progress, result, error")}catch(e){console.error("[AIStore] Failed to setup socket listeners:",e)}}initializePersistence(){P.persistenceService.initialize();let e=P.persistenceService.loadImages();e&&((0,o.h5)(()=>{e.uploadedImage&&(this.uploadedImage=e.uploadedImage),e.uploadedFaceImage&&(this.uploadedFaceImage=e.uploadedFaceImage),e.undressedImage?(this.undressedImage=e.undressedImage,this.currentImage=e.undressedImage):e.uploadedImage&&(this.currentImage=e.uploadedImage)}),console.log("[AIStore] Restored images from persistence"));let t=P.persistenceService.loadActiveGeneration();if(t&&("pending"===t.status||"processing"===t.status)){let e=Date.now()-t.startedAt;if(e<6e5&&!this.undressedImage){console.log("[AIStore] Found active generation, will resume:",t.requestId),(0,o.h5)(()=>{this.activeRequestId=t.requestId,this.setLoading(this.asyncStatuses.startStableJob)}),console.log("[AIStore] Restored loading state for active generation");let e=setTimeout(()=>{(0,o.h5)(()=>{this.activeRequestId===t.requestId&&(console.warn("[AIStore] Failsafe timeout: No backend response for 15 seconds, clearing stuck state"),this.activeRequestId=null,this.setSuccess(this.asyncStatuses.startStableJob),s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:e})=>{e.remove(t.requestId),console.log("[AIStore] Removed from PendingGenerationsService")}).catch(e=>console.error("[AIStore] Failed to clear pending generation:",e)))})},15e3);this.imageFailsafeTimeoutId=e}else e>=6e5?(console.log("[AIStore] Active generation too old, clearing"),P.persistenceService.clearActiveGeneration()):this.undressedImage&&(console.log("[AIStore] Result already exists, clearing active generation from persistence"),P.persistenceService.clearActiveGeneration())}}setupPersistenceReactions(){(0,o.mJ)(()=>({uploadedImage:this.uploadedImage,uploadedFaceImage:this.uploadedFaceImage,undressedImage:this.undressedImage}),e=>{P.persistenceService.saveImages(e)},{delay:500}),(0,o.mJ)(()=>({requestId:this.activeRequestId,isAccepted:this.isRequestAccepted}),e=>{e.requestId&&P.persistenceService.saveActiveGeneration({requestId:e.requestId,status:e.isAccepted?"processing":"pending",startedAt:Date.now(),lastUpdate:Date.now()})})}setMode(e){(0,o.h5)(()=>{this.currentMode!==e&&(this.uploadImageError=!1,this.serverError=!1,this.persistentError=null,e===q.KN.IMAGE_TO_VIDEO&&this.uploadedImage&&(console.log("[AIStore] Switching to video mode - syncing uploaded image to videoStore"),this.rootStore.videoStore.setUploadedImage(this.uploadedImage)),this.currentMode===q.KN.IMAGE_TO_VIDEO&&e!==q.KN.IMAGE_TO_VIDEO&&this.rootStore.videoStore.uploadedImage&&!this.uploadedImage&&(console.log("[AIStore] Switching from video mode - syncing image from videoStore to aiStore"),this.uploadedImage=this.rootStore.videoStore.uploadedImage,this.currentImage=this.rootStore.videoStore.uploadedImage)),this.currentMode=e})}setOutputType(e){(0,o.h5)(()=>{this.outputType=e})}clearPersistentError(){(0,o.h5)(()=>{this.persistentError=null})}setPersistentError(e){(0,o.h5)(()=>{this.persistentError=e})}resetCurrentImage(){(0,o.h5)(()=>{this.uploadedImage=null,this.uploadedFaceImage=null,this.currentImage=null,this.undressedImage=null,this.persistentError=null}),P.persistenceService.clearImages(),P.persistenceService.clearActiveGeneration()}resetUndressedImage(){(0,o.h5)(()=>{this.undressedImage=null,this.currentImage=this.uploadedImage}),P.persistenceService.clearActiveGeneration()}resetImage(){(0,o.h5)(()=>{this.uploadedImage=null})}resetFaceImage(){(0,o.h5)(()=>{this.uploadedFaceImage=null})}setUploadImageError(e){(0,o.h5)(()=>{this.uploadImageError=e})}async uploadImage(e){console.log("[AIStore] uploadImage received file",E(e)),this.setUploadImageError(!1);let t=this.asyncStatuses.uploadBodyImage;this.setLoading(t);try{console.log("[AIStore] Step 1: Resizing image...");let s=(await (0,C.yh)(e)).split(",")[1],r=atob(s),i=Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);let n=new Uint8Array(i),a=new File([n],e.name,{type:"image/jpeg"});console.log("[AIStore] Step 2: Uploading to S3...");let c=await w.uploadImage(a,e=>{console.log(`[AIStore] Upload progress: ${e.toFixed(1)}%`)});console.log("[AIStore] uploadImage complete, preloading from S3...",{file:E(e),s3Url:c}),await this.preloadImage(c),console.log("[AIStore] Image preloaded from S3, updating UI"),(0,o.h5)(()=>{this.uploadedImage=c,this.currentImage=c,this.persistentError=null,"imageToVideo"===this.currentMode&&(console.log("[AIStore] Syncing uploaded S3 URL to videoStore"),this.rootStore.videoStore.setUploadedImage(c))}),this.setSuccess(t)}catch(s){throw console.error("[AIStore] uploadImage failed",{file:E(e),error:s}),this.setUploadImageError(!0),this.setError(t,s),(0,o.h5)(()=>{this.persistentError="Error occurred. Please try again."}),s}}async uploadFaceImage(e){console.log("[AIStore] uploadFaceImage received file",E(e)),this.setUploadImageError(!1);let t=this.asyncStatuses.uploadFaceImage;this.setLoading(t);try{console.log("[AIStore] Step 1: Resizing face image...");let s=(await (0,C.yh)(e)).split(",")[1],r=atob(s),i=Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);let n=new Uint8Array(i),a=new File([n],e.name,{type:"image/jpeg"});console.log("[AIStore] Step 2: Uploading face image to S3...");let c=await w.uploadImage(a,e=>{console.log(`[AIStore] Face upload progress: ${e.toFixed(1)}%`)});console.log("[AIStore] uploadFaceImage complete, preloading from S3...",{file:E(e),s3Url:c}),await this.preloadImage(c),console.log("[AIStore] Face image preloaded from S3, updating UI"),(0,o.h5)(()=>{this.uploadedFaceImage=c,this.currentImage=c,this.persistentError=null}),this.setSuccess(t)}catch(s){throw console.error("[AIStore] uploadFaceImage failed",{file:E(e),error:s}),this.setUploadImageError(!0),this.setError(t,s),(0,o.h5)(()=>{this.persistentError="Error occurred. Please try again."}),s}}async undressCheck(){let e=this.asyncStatuses.undressCheck;this.setLoading(e);try{await this.rootStore.requester.undressService.undressImage(),this.setSuccess(e)}catch(t){throw this.setError(e,t),this.rootStore.modalsStore.noCreditsModal.open(),Error()}}get undressCheckStatus(){return this.getAsyncStatus(this.asyncStatuses.undressCheck)}buildSocketMessage(e,t){switch(e){case"connected":case"connecting":default:return null;case"reconnecting":return t?.attempt?`Reconnecting to generation server... (attempt ${t.attempt})`:"Reconnecting to generation server...";case"disconnected":return"Connection lost. Trying to reconnect...";case"error":return t?.error?.message??t?.reason??"Unable to connect to generation server."}}sanitizeErrorMessage(e){let t=e.toLowerCase();return t.includes("queue")||t.includes("busy")||t.includes("too many requests")?"Server is busy. Please try again in a few minutes.":t.includes("timeout")||t.includes("timed out")?"Request timed out. Please try again.":t.includes("rate limit")?"Too many requests. Please wait a moment and try again.":t.includes("connection")||t.includes("network")||t.includes("not reachable")||t.includes("unavailable")||t.includes("econnrefused")||t.includes("enotfound")?"Service temporarily unavailable. Please try again.":t.includes("credit")||t.includes("balance")||t.includes("insufficient")?"Insufficient credits. Please top up your account.":t.includes("invalid image")||t.includes("image format")||t.includes("unsupported")?"Invalid image format. Please upload a valid image.":t.includes("nsfw")||t.includes("content policy")||t.includes("inappropriate")?"Content not allowed. Please try a different image.":t.includes("invalid")||t.includes("parameter")||t.includes("validation")||t.includes("unknown")||t.includes("error")||t.includes("failed")||t.includes("exception")?"Something went wrong. Please try again.":e}parseBackendError(e){if(!e)return null;if("object"==typeof e){let{reason:t,message:s}=e;if("string"==typeof t){let e={service_unavailable:"Generation service is currently unavailable. Please try again.",credit_check_failed:"Unable to verify credits. Please try again.",credit_deduction_failed:"Failed to process credits. Please try again.",publish_failed:"Failed to process request. Please try again.",generation_timeout:"Generation is taking longer than expected. Your request is still processing - please check back in a moment.",generation_failed:"Generation failed. Please try again.",processing_failed:"Failed to process result. Please try again.",socket_timeout:"Request timed out. Your generation may still complete - please check your history.",socket_disconnected:"Connection lost. Please try again.",socket_connection_failed:"Unable to connect. Please try again.",empty_response:"Generation is taking longer than expected. Please check your history or try again.",rate_limit_exceeded:"Too many requests. Please wait before trying again."};return e[t]?e[t]:"string"==typeof s&&s?this.sanitizeErrorMessage(s):"An error occurred. Please try again."}}return"string"==typeof e?this.sanitizeErrorMessage(e):e instanceof Error?this.sanitizeErrorMessage(e.message):null}handleRequestAccepted(e){console.log("[AIStore] RequestAccepted event received:",e),this.activeRequestId===e.requestId&&(0,o.h5)(()=>{this.isRequestAccepted=!0})}handleProgress(e){if(console.log("[AIStore] Progress event received:",{requestId:e.requestId,progress:e.progress,status:e.status,queuePosition:e.queuePosition,hasImageUrl:!!e.imageUrl,hasPayload:!!e.payload}),this.activeRequestId===e.requestId){this.imageFailsafeTimeoutId&&(console.log("[AIStore] Progress received, cancelling failsafe timeout"),clearTimeout(this.imageFailsafeTimeoutId),this.imageFailsafeTimeoutId=null),e.externalRequestId&&s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:t})=>{t.updateProgress(e.requestId,e.progress,e.status,e.queuePosition),e.externalRequestId&&t.setExternalRequestId(e.requestId,e.externalRequestId)}).catch(e=>console.error("[AIStore] Failed to update progress:",e));let t=e.imageUrl||e.payload||e.base64Image;t?(console.log("[AIStore] Progress event contains result, treating as completion"),this.handleComplete({requestId:e.requestId,imageUrl:t,generatedAt:new Date().toISOString()})):console.log("[AIStore] Image generation progress update:",{progress:e.progress,status:e.status,queuePosition:e.queuePosition})}}preloadImage(e){return new Promise((t,s)=>{let r=new Image;r.onload=()=>t(),r.onerror=()=>s(Error("Failed to preload image")),r.src=e})}handleComplete(e){if(console.log("[AIStore] Result event received:",e),!e.imageUrl)return void console.log("[AIStore] Result event is not for image generation (no imageUrl), ignoring");if(this.activeRequestId===e.requestId){this.imageFailsafeTimeoutId&&(console.log("[AIStore] Result received, cancelling failsafe timeout"),clearTimeout(this.imageFailsafeTimeoutId),this.imageFailsafeTimeoutId=null);let t=e.imageUrl,s=e.requestId;console.log("[AIStore] Preloading generated image before showing..."),this.preloadImage(t).then(()=>{console.log("[AIStore] Image preloaded successfully, updating UI"),(0,o.h5)(()=>{this.currentImage=t,this.undressedImage=t,this.serverError=!1,this.serverErrorCount=0,this.persistentError=null,this.lastRequestId=s,this.activeRequestId=null,this.isRequestAccepted=!1}),P.persistenceService.clearActiveGeneration(),this.rootStore.userStore.getMe(!0,!0),this.setSuccess(this.asyncStatuses.startStableJob)}).catch(e=>{console.warn("[AIStore] Image preload failed, showing anyway:",e),(0,o.h5)(()=>{this.currentImage=t,this.undressedImage=t,this.serverError=!1,this.serverErrorCount=0,this.persistentError=null,this.lastRequestId=s,this.activeRequestId=null,this.isRequestAccepted=!1}),P.persistenceService.clearActiveGeneration(),this.rootStore.userStore.getMe(!0,!0),this.setSuccess(this.asyncStatuses.startStableJob)})}}handleError(e){if(console.log("[AIStore] Error event received:",e,"activeRequestId:",this.activeRequestId),this.activeRequestId===e.requestId||this.activeRequestId&&!this.isRequestAccepted){let t=this.parseBackendError(e);(0,o.h5)(()=>{this.persistentError=t||"Error occurred. Please try again.",this.undressedImage=null,this.currentImage=this.uploadedImage,t?.toLowerCase().includes("connect")||t?.toLowerCase().includes("unavailable")?(this.serverError=!1,this.serverErrorCount=0):(this.serverError=!0,this.serverErrorCount+=1,this.serverErrorCount>1&&(console.log("RELOADING PAGE DUE TO REPEATED ERRORS"),setTimeout(()=>window.location.reload(),2e3))),this.lastRequestId=e.requestId,this.activeRequestId=null,this.isRequestAccepted=!1}),this.imageFailsafeTimeoutId&&(console.log("[AIStore] Error received, cancelling failsafe timeout"),clearTimeout(this.imageFailsafeTimeoutId),this.imageFailsafeTimeoutId=null),P.persistenceService.clearActiveGeneration(),console.log("[AIStore] Cleared active generation from persistence after error"),s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:t})=>{t.remove(e.requestId),console.log("[AIStore] Removed from PendingGenerationsService after error")}).catch(e=>console.error("[AIStore] Failed to clear pending generation:",e)),(t?.toLowerCase().includes("connect")||t?.toLowerCase().includes("unavailable"))&&this.rootStore.requester.socketService.reconnect(),this.rootStore.userStore.getMe(!0,!0),this.setError(this.asyncStatuses.startStableJob,e)}}async startStableJob(e){let t=this.asyncStatuses.startStableJob;(0,o.h5)(()=>{this.persistentError=null,this.rootStore.videoStore.clearError()});try{let r=Date.now(),i=r-this.lastRequestTime;if(i<this.minRequestInterval){let e=this.minRequestInterval-i;throw Error(`Please wait ${Math.ceil(e/1e3)} seconds before generating again.`)}this.setLoading(t),this.lastRequestTime=r;let n=crypto.randomUUID();(0,o.h5)(()=>{this.activeRequestId=n,this.isRequestAccepted=!1}),s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:t})=>{t.add({requestId:n,type:e.mode||"image",startedAt:Date.now()})}).catch(e=>console.error("[AIStore] Failed to track pending generation:",e));let{image:a,faceImage:c,...l}=e,d=e=>e&&(e.startsWith("http://")||e.startsWith("https://"));if(this.uploadedImage&&!d(this.uploadedImage))throw console.error("[AIStore] uploadedImage is not a valid URL:",this.uploadedImage?.substring(0,100)),Error("Image must be uploaded to S3 first. Please try uploading the image again.");if(this.uploadedFaceImage&&!d(this.uploadedFaceImage))throw console.error("[AIStore] uploadedFaceImage is not a valid URL:",this.uploadedFaceImage?.substring(0,100)),Error("Face image must be uploaded to S3 first. Please try uploading the image again.");let u="video"===l.outputType,h=u?"imageToVideo":e.mode;u?((0,o.h5)(()=>{this.rootStore.videoStore.activeRequestId=n,this.rootStore.videoStore.isGenerating=!0,this.rootStore.videoStore.error=null,this.rootStore.videoStore.progress=null,this.rootStore.videoStore.queuePosition=null}),console.log("[AIStore] Started video generation tracking in VideoStore:",n)):((0,o.h5)(()=>{this.rootStore.videoStore.isGenerating=!1,this.rootStore.videoStore.activeRequestId=null,this.rootStore.videoStore.progress=null,this.rootStore.videoStore.queuePosition=null,this.rootStore.videoStore.persistState()}),console.log("[AIStore] Cleared VideoStore state for image generation"));let g=u?{imageUrl:this.uploadedImage,style:l.videoStyle||"blowjob",duration:parseInt(l.videoDuration||"3",10),size:l.videoSize||"512x512"}:{...l,...this.uploadedImage&&{imageUrl:this.uploadedImage},...this.uploadedFaceImage&&{faceImageUrl:this.uploadedFaceImage}};this.rootStore.requester.socketService.sendMessage("undress.zone",{type:h,params:g,requestId:n}).catch(e=>{console.log("[AIStore] Socket sendMessage error:",{error:e,reason:e?.reason,message:e?.message});let r="string"==typeof e?.reason?e.reason.toLowerCase():"",i="string"==typeof e?.message?e.message.toLowerCase():"",a=r.includes("timeout")||i.includes("timeout"),c=r.includes("socket_disconnected")||r.includes("socket_connection_failed")||r.includes("connect")||i.includes("disconnected")||i.includes("connection failed");if(e?.noCredits)this.rootStore.modalsStore.noCreditsModal.open(),(0,o.h5)(()=>{this.activeRequestId=null,this.isRequestAccepted=!1}),P.persistenceService.clearActiveGeneration(),s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:e})=>{e.remove(n),console.log("[AIStore] Cleared persistence after noCredits error")}).catch(e=>console.error("[AIStore] Failed to clear pending generation:",e));else if(c||e?.reason!=="empty_response"&&!a){console.error("[AIStore] Critical socket error:",e?.message||e?.reason||"Unknown","| Request ID:",this.activeRequestId);let r=this.parseBackendError(e);(0,o.h5)(()=>{this.persistentError=r||"Error occurred. Please try again.",this.undressedImage=null,this.currentImage=this.uploadedImage,this.activeRequestId=null,this.isRequestAccepted=!1}),P.persistenceService.clearActiveGeneration(),s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:e})=>{e.remove(n),console.log("[AIStore] Cleared persistence after critical error")}).catch(e=>console.error("[AIStore] Failed to clear pending generation:",e)),this.setError(t,e)}else console.log("[AIStore] Ignoring non-critical socket error, keeping activeRequestId:",{activeRequestId:this.activeRequestId,reason:e?.reason,message:e?.message})}),console.log("[AIStore] Message sent, waiting for events...")}catch(e){console.error("[AIStore] Generation error:",e),(0,o.h5)(()=>{this.persistentError="Error occurred. Please try again.",this.activeRequestId=null,this.isRequestAccepted=!1}),P.persistenceService.clearActiveGeneration(),console.log("[AIStore] Cleared persistence after generation exception"),this.setError(t,e)}}get startStableJobStatus(){return this.getAsyncStatus(this.asyncStatuses.startStableJob)}get uploadBodyStatus(){return this.getAsyncStatus(this.asyncStatuses.uploadBodyImage)}get uploadFaceStatus(){return this.getAsyncStatus(this.asyncStatuses.uploadFaceImage)}}var x=s(83599);class F extends a{constructor(e){super(e),this.asyncStatuses={authWithGoogle:this.createKey("authWithGoogle"),logout:this.createKey("logout"),restoreAccount:this.createKey("restoreAccount")},(0,o.Gn)(this,{authWithGoogle:o.XI.bound,logout:o.XI.bound,restoreAccount:o.XI.bound,inintSocket:o.XI.bound,reconnectSocket:o.XI.bound,restoreAccountStatus:o.EW,restoreAccountError:o.EW})}inintSocket(){this.rootStore.requester.socketService.initialize()}reconnectSocket(){this.rootStore.requester.socketService.reconnect(),this.rootStore.requester.socketService.reconnect()}async authWithGoogle(e){let t=this.asyncStatuses.authWithGoogle;this.setLoading(t);try{await this.rootStore.requester.authService.authWithGoogle(e),await this.rootStore.userStore.getMe(!0),this.rootStore.userStore.navigateToHome(),this.rootStore.authStore.reconnectSocket(),this.setSuccess(t)}catch(e){this.setError(t,e)}}async restoreAccount(e){let t=this.asyncStatuses.restoreAccount;this.setLoading(t);try{await this.rootStore.requester.authService.restoreAccount(e),await this.rootStore.userStore.getMe(!0),this.rootStore.userStore.navigateToHome(),this.rootStore.authStore.reconnectSocket(),this.setSuccess(t)}catch(e){this.setError(t,e)}}async logout(){let e=this.asyncStatuses.logout;this.setLoading(e);try{await this.rootStore.requester.authService.logout(),localStorage.removeItem("videoStore"),localStorage.removeItem("formSettings"),console.log("[AuthStore] Cleared user-specific persisted state from localStorage"),this.rootStore.videoStore.reset(),(0,o.h5)(()=>{this.rootStore.aiStore.uploadedImage=null,this.rootStore.aiStore.uploadedFaceImage=null,this.rootStore.aiStore.undressedImage=null,console.log("[AuthStore] Cleared AI store state (uploaded images, generation results)")}),this.rootStore.routeStore.navigate(x.H_),(0,o.h5)(()=>{this.rootStore.userStore.user=null}),await this.rootStore.userStore.getMe(!0),this.rootStore.authStore.reconnectSocket(),this.setSuccess(e)}catch(t){this.setError(e,t)}}get restoreAccountStatus(){return this.getAsyncStatus(this.asyncStatuses.restoreAccount)}get restoreAccountError(){return this.getAsyncError(this.asyncStatuses.restoreAccount)}}class M{constructor(){this.state=!1,(0,o.Gn)(this,{state:o.sH,isOpen:o.EW,isClosed:o.EW,open:o.XI.bound,close:o.XI.bound})}get isOpen(){return this.state}get isClosed(){return!this.state}open(){this.state=!0}close(){this.state=!1}}class T{constructor(){this.congratulationModal=new M,this.noCreditsModal=new M,this.premiumOnlyModal=new M,this.adultsOnlyModal=new M,this.mobileMenu=new M,this.creditsInfoModal=new M,this.affiliateInfoModal=new M,this.patreonModal=new M,this.settingsModal=new M,this.contactUsModal=new M,this.deleteAccountModal=new M,this.promoRewardModal=new M,(0,o.l_)(this)}}class U extends a{constructor(e){super(e),this.promoCodeHistory=[],this.error=null,this.lastAppliedPromo=null,this.adminRefCodes=[],this.adminPromoCodes=[],this.asyncStatuses={applyPromoCode:this.createKey("applyPromoCode"),getUserPromoCodes:this.createKey("getUserPromoCodes"),fetchAdminRefCodes:this.createKey("fetchAdminRefCodes"),fetchAdminPromoCodes:this.createKey("fetchAdminPromoCodes"),createAdminPromoCode:this.createKey("createAdminPromoCode")},this.applyPromoCode=async e=>{this.setLoading(this.asyncStatuses.applyPromoCode),this.error=null,this.lastAppliedPromo=null;try{let t=await this.rootStore.requester.promoCodeService.applyPromoCode(e);return await this.getUserPromoCodes(),await this.rootStore.userStore.getMe(!0,!0),(0,o.h5)(()=>{this.lastAppliedPromo=t}),this.rootStore.modalsStore.promoRewardModal.open(),this.setSuccess(this.asyncStatuses.applyPromoCode),t}catch(e){throw console.error("Error applying promocode:",e),(0,o.h5)(()=>{this.error=e.response?.data?.message||e.message||"Failed to apply promocode",this.lastAppliedPromo=null}),this.rootStore.modalsStore.promoRewardModal.close(),this.setError(this.asyncStatuses.applyPromoCode,e),e}},this.getUserPromoCodes=async()=>{this.setLoading(this.asyncStatuses.getUserPromoCodes),this.error=null;try{let e=await this.rootStore.requester.promoCodeService.getUserPromoCodes();(0,o.h5)(()=>{this.promoCodeHistory=e}),this.setSuccess(this.asyncStatuses.getUserPromoCodes)}catch(e){console.error("Error getting promocode history:",e),(0,o.h5)(()=>{this.error=e.response?.data?.message||e.message||"Failed to load promocode history"}),this.setError(this.asyncStatuses.getUserPromoCodes,e)}},this.fetchAdminRefCodes=async()=>{let e=this.asyncStatuses.fetchAdminRefCodes;this.setLoading(e),this.error=null;try{let t=await this.rootStore.requester.promoCodeService.listRefCodes();(0,o.h5)(()=>{this.adminRefCodes=t}),this.setSuccess(e)}catch(t){throw console.error("Error loading ref codes:",t),(0,o.h5)(()=>{this.error=t.response?.data?.message||t.message||"Failed to load ref codes"}),this.setError(e,t),t}},this.fetchAdminPromoCodes=async()=>{let e=this.asyncStatuses.fetchAdminPromoCodes;this.setLoading(e),this.error=null;try{let t=await this.rootStore.requester.promoCodeService.listPromoCodes();(0,o.h5)(()=>{this.adminPromoCodes=t}),this.setSuccess(e)}catch(t){throw console.error("Error loading promocodes:",t),(0,o.h5)(()=>{this.error=t.response?.data?.message||t.message||"Failed to load promocodes"}),this.setError(e,t),t}},this.createAdminPromoCode=async e=>{let t=this.asyncStatuses.createAdminPromoCode;this.setLoading(t),this.error=null;try{let s=await this.rootStore.requester.promoCodeService.createPromoCode(e);return await this.fetchAdminPromoCodes(),this.setSuccess(t),s}catch(e){throw console.error("Error creating promocode:",e),(0,o.h5)(()=>{this.error=e.response?.data?.message||e.message||"Failed to create promocode"}),this.setError(t,e),e}},(0,o.Gn)(this,{promoCodeHistory:!0,error:!0,lastAppliedPromo:!0,adminRefCodes:!0,adminPromoCodes:!0,applyPromoCode:o.XI,getUserPromoCodes:o.XI,fetchAdminRefCodes:o.XI,fetchAdminPromoCodes:o.XI,createAdminPromoCode:o.XI})}}class L extends a{constructor(e){super(e),this.router=null,(0,o.Gn)(this,{router:o.sH,setRouter:o.XI.bound})}setRouter(e){e&&(this.router=e)}navigate(e){this.router&&this.router.push(e)}}class G extends a{constructor(e){super(e),this.user=null,this.refCodesStat=null,this.paymentLink=null,this.adminRefStats=null,this.refCodeList=[],this.selectedSubscriptionType=null,this.asyncStatuses={getMe:this.createKey("getMe"),updateMe:this.createKey("updateMe"),setRefCode:this.createKey("setRefCode"),getRefCode:this.createKey("getRefCode"),requestWithdraw:this.createKey("requestWithdraw"),getRefStats:this.createKey("getRefStats"),getRefCodes:this.createKey("getRefCodes"),clearAdminImages:this.createKey("clearAdminImages"),getPaymentLink:this.createKey("getPaymentLink"),getCryptoPaymentLink:this.createKey("getCryptoPaymentLink"),createSubscription:this.createKey("createSubscription"),createPaymentLink:this.createKey("createPaymentLink"),getDimondPaymentLink:this.createKey("getDimondPaymentLink"),generateCryptoAddress:this.createKey("generateCryptoAddress"),deleteAccount:this.createKey("deleteAccount"),updateUserDiscount:this.createKey("updateUserDiscount"),cancelSubscription:this.createKey("cancelSubscription")},this.openExternalLink=e=>{let t=window.open(e,"_blank");(!t||t.closed||void 0===t.closed)&&(console.log("Popup was blocked"),setTimeout(()=>{window.location.href=e},100))},(0,o.Gn)(this,{user:o.sH,isLoaded:o.EW,isAuthorized:o.EW,getMe:o.XI.bound,updateMe:o.XI.bound,updateMeStatus:o.EW,setRefCode:o.XI.bound,setRefCodeStatus:o.EW,refCodesStat:o.sH,getRefCode:o.XI.bound,getRefCodeStatus:o.EW,subscribeToMeUpdates:o.XI.bound,requestWithdraw:o.XI.bound,requestWithdrawStatus:o.EW,getRefStats:o.XI.bound,getRefStatsStatus:o.EW,refCodeList:o.sH,getRefCodes:o.XI.bound,getRefCodesStatus:o.EW,clearAdminImages:o.XI.bound,clearAdminImagesStatus:o.EW,updateUserDiscount:o.XI.bound,updateUserDiscountStatus:o.EW,selectedSubscriptionType:o.sH,getCryptoPaymentLink:o.XI.bound,getCryptoPaymentLinkStatus:o.EW,createSubscription:o.XI.bound,createSubscriptionStatus:o.EW,createPaymentLink:o.XI.bound,createPaymentLinkStatus:o.EW,getDimondPaymentLink:o.XI.bound,getDimondPaymentLinkStatus:o.EW,paymentLink:o.sH,generateCryptoAddress:o.XI.bound,generateCryptoAddressStatus:o.EW,deleteAccount:o.XI.bound,deleteAccountStatus:o.EW,registerPaymentAttempt:o.XI.bound,cancelSubscription:o.XI.bound,cancelSubscriptionStatus:o.EW})}get isAuthorized(){return!!this.user?.id}get isLoaded(){return this.getAsyncStatus(this.asyncStatuses.getMe).success||this.getAsyncStatus(this.asyncStatuses.getMe).error}navigateToHome(){this.rootStore.routeStore.navigate(x.H_)}async getMe(e,t=!1){let s=this.asyncStatuses.getMe;try{t||this.setLoading(s);let e=await this.rootStore.requester.userService.getMe();(0,o.h5)(()=>{this.user=e}),this.setSuccess(s)}catch(e){t?console.warn("[UserStore] Silent getMe failed, keeping user session:",e):((0,o.h5)(()=>{this.user=null}),this.setError(s,e))}}subscribeToMeUpdates(){this.rootStore.requester.socketService.subscribe("me",()=>{this.getMe(!0,!0)}),this.rootStore.requester.socketService.subscribe("payment:success",()=>{this.getMe(!0,!0)})}async updateMe(e,t){let s=this.asyncStatuses.updateMe;this.setLoading(s);try{await this.rootStore.requester.userService.updateMe(e),await this.getMe(!0),t&&this.rootStore.routeStore.navigate(t),this.rootStore.modalsStore.congratulationModal.close(),this.setSuccess(s)}catch(e){this.setError(s,e)}}get updateMeStatus(){return this.getAsyncStatus(this.asyncStatuses.updateMe)}async getRefCode(){let e=this.asyncStatuses.getRefCode;this.setLoading(e);try{let t=await this.rootStore.requester.userService.getRefCode();(0,o.h5)(()=>{this.refCodesStat=t}),this.setSuccess(e)}catch(t){this.setError(e,t)}}get getRefCodeStatus(){return this.getAsyncStatus(this.asyncStatuses.getRefCode)}async requestWithdraw(e){let t=this.asyncStatuses.requestWithdraw;this.setLoading(t);try{await this.rootStore.requester.userService.requestWithdraw({address:e,amount:this.refCodesStat?.available}),await this.getRefCode(),this.setSuccess(t)}catch(e){this.setError(t,e)}}get requestWithdrawStatus(){return this.getAsyncStatus(this.asyncStatuses.requestWithdraw)}async setRefCode(e){let t=this.asyncStatuses.setRefCode;this.setLoading(t);try{await this.rootStore.requester.userService.setRefCode(e),this.setSuccess(t)}catch(e){this.setError(t,e)}}get setRefCodeStatus(){return this.getAsyncStatus(this.asyncStatuses.setRefCode)}async getRefStats(e="all"){let t=this.asyncStatuses.getRefStats;this.setLoading(t);try{let s=await this.rootStore.requester.userService.getRefStats(e);(0,o.h5)(()=>{this.adminRefStats=s}),this.setSuccess(t)}catch(e){this.setError(t,e)}}get getRefStatsStatus(){return this.getAsyncStatus(this.asyncStatuses.getRefStats)}async getRefCodes(){let e=this.asyncStatuses.getRefCodes;this.setLoading(e);try{let t=await this.rootStore.requester.userService.getRefCodes();(0,o.h5)(()=>{this.refCodeList=t}),this.setSuccess(e)}catch(t){this.setError(e,t)}}get getRefCodesStatus(){return this.getAsyncStatus(this.asyncStatuses.getRefCodes)}async clearAdminImages(e){let t=this.asyncStatuses.clearAdminImages;this.setLoading(t);try{let s=await this.rootStore.requester.userService.clearAdminImages(e);return this.setSuccess(t),s}catch(e){throw this.setError(t,e),e}}get clearAdminImagesStatus(){return this.getAsyncStatus(this.asyncStatuses.clearAdminImages)}async updateUserDiscount(e){let t=this.asyncStatuses.updateUserDiscount;this.setLoading(t);try{let s=await this.rootStore.requester.userService.updateUserDiscount(e);return this.user&&this.user.email===s.email&&(0,o.h5)(()=>{this.user={...this.user,discountPercentage:s.discountPercentage}}),this.setSuccess(t),s}catch(e){throw this.setError(t,e),e}}get updateUserDiscountStatus(){return this.getAsyncStatus(this.asyncStatuses.updateUserDiscount)}async getCryptoPaymentLink(e,t){let s=this.asyncStatuses.getCryptoPaymentLink;this.setLoading(s);try{(0,o.h5)(()=>{this.selectedSubscriptionType=e});let r=await this.rootStore.requester.userService.getCryptoPaymentLink(e,t,q.GK.MERCURYO);return this.paymentLink=r?.paymentUrl||null,this.setSuccess(s),r?.paymentUrl}catch(e){this.setError(s,e)}}get getCryptoPaymentLinkStatus(){return this.getAsyncStatus(this.asyncStatuses.getCryptoPaymentLink)}async getDimondPaymentLink(e,t){let s=this.asyncStatuses.getDimondPaymentLink;this.setLoading(s);try{(0,o.h5)(()=>{this.selectedSubscriptionType=e});let s=await this.rootStore.requester.userService.getDimondPaymentLink(e,t);return s?.paymentUrl}catch(e){this.setError(s,e)}}get getDimondPaymentLinkStatus(){return this.getAsyncStatus(this.asyncStatuses.getDimondPaymentLink)}async createSubscription(e){let t=this.asyncStatuses.createSubscription;this.setLoading(t);try{(0,o.h5)(()=>{this.selectedSubscriptionType=e}),await this.rootStore.requester.userService.createSubscription(e),this.setSuccess(t)}catch(e){this.setError(t,e)}}get createSubscriptionStatus(){return this.getAsyncStatus(this.asyncStatuses.createSubscription)}async createPaymentLink(e,t=!1){let s=this.asyncStatuses.createPaymentLink;this.setLoading(s);try{let r=await this.rootStore.requester.userService.createPaymentLink(e,t);return(0,o.h5)(()=>{this.paymentLink=r.redirectUrl}),this.setSuccess(s),r.redirectUrl}catch(e){this.setError(s,e)}}get createPaymentLinkStatus(){return this.getAsyncStatus(this.asyncStatuses.createPaymentLink)}registerPaymentAttempt(){this.schedulePaymentFollowUpEmail()}async schedulePaymentFollowUpEmail(){try{await this.rootStore.requester.userService.schedulePaymentFollowUp()}catch(e){console.error("Failed to schedule payment follow-up email",e)}}async generateCryptoAddress(e,t=!1){let s=this.asyncStatuses.generateCryptoAddress;this.setLoading(s);try{let r=await this.rootStore.requester.userService.generateCryptoAddress(e,t);return this.setSuccess(s),r}catch(e){throw this.setError(s,e),e}}get generateCryptoAddressStatus(){return this.getAsyncStatus(this.asyncStatuses.generateCryptoAddress)}async deleteAccount(){let e=this.asyncStatuses.deleteAccount;this.setLoading(e);try{await this.rootStore.requester.userService.deleteAccount(),(0,o.h5)(()=>{this.user=null}),this.rootStore.routeStore.navigate(x.H_),this.rootStore.authStore.reconnectSocket(),this.setSuccess(e)}catch(t){throw this.setError(e,t),t}}get deleteAccountStatus(){return this.getAsyncStatus(this.asyncStatuses.deleteAccount)}async cancelSubscription(){let e=this.asyncStatuses.cancelSubscription;this.setLoading(e);try{let{url:t}=await this.rootStore.requester.userService.getCancelSubscriptionUrl();window.open(t,"_blank","noopener,noreferrer"),this.setSuccess(e)}catch(t){throw this.setError(e,t),t}}get cancelSubscriptionStatus(){return this.getAsyncStatus(this.asyncStatuses.cancelSubscription)}}var V=s(39838);class D extends a{constructor(e){super(e),this.uploadedImage=null,this.uploadProgress=0,this.isUploading=!1,this.textPrompt="",this.selectedFormat="mp4",this.selectedAspectRatio="16:9",this.selectedDuration=3,this.selectedSize="512x512",this.selectedStyle="blowjob",this.activeRequestId=null,this.serverRequestId=null,this.generatedVideo=null,this.progress=null,this.isGenerating=!1,this.error=null,this.queuePosition=null,this.canCancel=!1,this.isCancelling=!1,this.verificationTimeoutId=null,(0,o.Gn)(this,{uploadedImage:o.sH,uploadProgress:o.sH,isUploading:o.sH,textPrompt:o.sH,selectedFormat:o.sH,selectedAspectRatio:o.sH,selectedDuration:o.sH,selectedSize:o.sH,selectedStyle:o.sH,activeRequestId:o.sH,serverRequestId:o.sH,generatedVideo:o.sH.ref,progress:o.sH.ref,isGenerating:o.sH,error:o.sH,queuePosition:o.sH,canCancel:o.sH,isCancelling:o.sH,setUploadedImage:o.XI.bound,uploadImageToS3:o.XI.bound,setTextPrompt:o.XI.bound,setFormat:o.XI.bound,setAspectRatio:o.XI.bound,setDuration:o.XI.bound,setSize:o.XI.bound,setStyle:o.XI.bound,generateImageToVideo:o.XI.bound,generateTextToVideo:o.XI.bound,clearError:o.XI.bound,reset:o.XI.bound,clearResult:o.XI.bound,handleRequestAccepted:o.XI.bound,handleProgress:o.XI.bound,handleComplete:o.XI.bound,handleError:o.XI.bound,handleCancelled:o.XI.bound,restoreState:o.XI.bound,persistState:o.XI.bound,updateQueueStatus:o.XI.bound,cancelGeneration:o.XI.bound,creditCost:o.EW,canGenerateImage:o.EW,canGenerateText:o.EW,displayRequestId:o.EW}),this.restoreState(),this.setupSocketListeners()}setupSocketListeners(){setTimeout(()=>{try{let e=this.rootStore.requester?.socketService;if(!e)return void console.warn("Socket service not available yet");e.subscribe("requestAccepted",this.handleRequestAccepted),e.subscribe("progress",this.handleProgress),e.subscribe("result",this.handleComplete),e.subscribe("error",this.handleError),e.subscribe("cancelled",this.handleCancelled),console.log("[VideoStore] Subscribed to video socket events: requestAccepted, progress, result, error, cancelled")}catch(e){console.error("Failed to setup socket listeners:",e)}},1e3)}handleRequestAccepted(e){this.activeRequestId===e.requestId&&(0,o.h5)(()=>{this.isGenerating=!0,e.externalRequestId&&(this.serverRequestId=e.externalRequestId)})}eventMatchesActiveRequest(e){let t=e.requestId&&this.activeRequestId&&e.requestId===this.activeRequestId,s=e.externalRequestId&&this.serverRequestId&&e.externalRequestId===this.serverRequestId;return console.log("[VideoStore] Event matching check:",{eventRequestId:e.requestId,eventExternalId:e.externalRequestId,activeClientId:this.activeRequestId,activeServerId:this.serverRequestId,matchesClient:t,matchesServer:s}),t||s||console.warn("[VideoStore] Event discarded - requestId mismatch",{activeClientId:this.activeRequestId,activeServerId:this.serverRequestId,eventRequestId:e.requestId,eventExternalId:e.externalRequestId}),!!(t||s)}handleProgress(e){console.log("[VideoStore] Progress event received:",{data:e,queuePosition:e.queuePosition,queuePositionType:typeof e.queuePosition,progress:e.progress,status:e.status,activeRequestId:this.activeRequestId,matches:this.activeRequestId===e.requestId,isGenerating:this.isGenerating,currentProgress:this.progress}),this.eventMatchesActiveRequest(e)?(this.verificationTimeoutId&&(console.log("[VideoStore] Progress received, cancelling verification timeout"),clearTimeout(this.verificationTimeoutId),this.verificationTimeoutId=null),this.failsafeTimeoutId&&(console.log("[VideoStore] Progress received, cancelling failsafe timeout"),clearTimeout(this.failsafeTimeoutId),this.failsafeTimeoutId=null),(0,o.h5)(()=>{e.externalRequestId&&(this.serverRequestId=e.externalRequestId);let t=this.normalizeQueuePosition(e.queuePosition),s=e.canCancel??("number"==typeof t?t>=1:this.canCancel);this.progress={...e,queuePosition:t??void 0,canCancel:s},this.isGenerating=!0;let r=this.rootStore.aiStore;r&&!r.startStableJobStatus.loading&&console.log("[VideoStore] Setting AIStore loading state - generation confirmed active"),null!==t?(this.queuePosition=t,this.canCancel=s):(this.queuePosition=null,void 0!==e.canCancel&&(this.canCancel=e.canCancel)),console.log("[VideoStore] Queue position update:",{queuePosition:t,rawQueuePosition:e.queuePosition,canCancelFromData:e.canCancel,canCancelSet:this.canCancel}),console.log("[VideoStore] Progress updated:",{progress:this.progress,queuePosition:this.queuePosition,canCancel:this.canCancel,isGenerating:this.isGenerating,rawData:e}),this.persistState()})):console.warn("[VideoStore] Progress requestId mismatch!",{activeRequestId:this.activeRequestId,eventRequestId:e.requestId})}handleComplete(e){if(console.log("[VideoStore] Result event received:",e),this.eventMatchesActiveRequest(e)){(0,o.h5)(()=>{e.externalRequestId&&(this.serverRequestId=e.externalRequestId??null),this.generatedVideo=e,this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null,this.progress=null,this.persistState()});let t=this.rootStore.aiStore;if(t){console.log("[VideoStore] Clearing AIStore loading state after video completion");let e=t.asyncStatuses?.startStableJob;e&&(t.setSuccess(e),console.log("[VideoStore] AIStore loading state cleared successfully")),(0,o.h5)(()=>{t.activeRequestId&&(t.activeRequestId=null,t.isRequestAccepted=!1,console.log("[VideoStore] Cleared AIStore activeRequestId"))}),Promise.resolve().then(s.bind(s,1889)).then(({persistenceService:e})=>{e.clearActiveGeneration(),console.log("[VideoStore] Cleared active generation from persistence after video completion")}).catch(e=>console.error("[VideoStore] Failed to clear persistence:",e)),s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:e})=>{t.activeRequestId&&(e.remove(t.activeRequestId),console.log("[VideoStore] Removed stale generation from PendingGenerationsService"))}).catch(e=>console.error("[VideoStore] Failed to import PendingGenerationsService:",e))}}}handleError(e){if(console.log("[VideoStore] Error event received:",e),`${e.reason||""} ${e.message||""} ${e.error||""}`.toLowerCase().includes("generation timeout"))return void console.warn("[VideoStore] Ignoring generation timeout error event (handled server-side).");if("cancel_failed"===e.reason){console.log("[VideoStore] Cancel failed:",e.message),(0,o.h5)(()=>{if(this.activeRequestId===e.requestId){if(this.isCancelling=!1,this.generatedVideo?.videoUrl)return void console.log("[VideoStore] Cancel failed but video already completed - ignoring error");if(e.message?.includes("not found")||e.message?.includes("already completed")||e.message?.includes("already finished")){console.log("[VideoStore] Generation already finished - treating as successful cancel"),this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null,this.progress=null,this.persistState();return}this.error=e.message||e.error||"Failed to cancel generation"}});return}if(this.eventMatchesActiveRequest(e)){(0,o.h5)(()=>{e.externalRequestId&&(this.serverRequestId=e.externalRequestId),this.error=this.getFriendlyErrorMessage(e.reason,e.message||e.error||"Video generation failed"),this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null,this.progress=null,this.persistState()});let t=this.rootStore.aiStore;if(t){console.log("[VideoStore] Clearing AIStore loading state after error");let e=t.asyncStatuses?.startStableJob;e&&(t.setError(e),console.log("[VideoStore] AIStore loading state cleared (error) successfully")),(0,o.h5)(()=>{t.activeRequestId&&(t.activeRequestId=null,t.isRequestAccepted=!1,console.log("[VideoStore] Cleared AIStore activeRequestId"))}),Promise.resolve().then(s.bind(s,1889)).then(({persistenceService:e})=>{e.clearActiveGeneration(),console.log("[VideoStore] Cleared active generation from persistence after error")}).catch(e=>console.error("[VideoStore] Failed to clear persistence:",e))}}}handleCancelled(e){console.log("[VideoStore] Cancelled event received:",{eventData:e,currentActiveRequestId:this.activeRequestId,currentServerRequestId:this.serverRequestId,isCancelling:this.isCancelling});let t=this.eventMatchesActiveRequest(e);if(console.log("[VideoStore] Cancelled event matching result:",t),t){console.log("[VideoStore] Cancellation confirmed - clearing generation state"),(0,o.h5)(()=>{this.isGenerating=!1,this.isCancelling=!1,this.activeRequestId=null,this.serverRequestId=null,this.progress=null,this.queuePosition=null,this.canCancel=!1,this.error=null,this.persistState()});let e=this.rootStore.aiStore;if(e){console.log("[VideoStore] Clearing AIStore loading state after cancellation");let t=e.asyncStatuses?.startStableJob;t&&(e.setSuccess(t),console.log("[VideoStore] AIStore loading state cleared successfully")),(0,o.h5)(()=>{e.activeRequestId&&(e.activeRequestId=null,e.isRequestAccepted=!1,console.log("[VideoStore] Cleared AIStore activeRequestId"))}),Promise.resolve().then(s.bind(s,1889)).then(({persistenceService:e})=>{e.clearActiveGeneration(),console.log("[VideoStore] Cleared active generation from persistence after cancellation")}).catch(e=>console.error("[VideoStore] Failed to clear persistence:",e))}}else console.warn("[VideoStore] Cancelled event did not match active request - ignoring")}setUploadedImage(e){(0,o.h5)(()=>{this.uploadedImage=e,this.error=null,this.persistState()})}async uploadImageToS3(e){let t=w.validateFile(e);if(!t.valid)throw(0,o.h5)(()=>{this.error=t.error||"Invalid file"}),Error(t.error);(0,o.h5)(()=>{this.isUploading=!0,this.uploadProgress=0,this.error=null,this.uploadedImage=null});try{let t=await w.uploadImage(e,e=>{(0,o.h5)(()=>{this.uploadProgress=e})});(0,o.h5)(()=>{this.uploadedImage=t,this.isUploading=!1,this.uploadProgress=100,this.persistState()}),console.log("[VideoStore] Image uploaded to S3:",t)}catch(e){throw(0,o.h5)(()=>{this.error="Error occurred. Please try again.",this.isUploading=!1,this.uploadProgress=0,this.uploadedImage=null}),console.error("[VideoStore] Upload failed:",e),e}}setTextPrompt(e){(0,o.h5)(()=>{this.textPrompt=e,this.error=null,this.persistState()})}setFormat(e){(0,o.h5)(()=>{this.selectedFormat=e,this.persistState()})}setAspectRatio(e){(0,o.h5)(()=>{this.selectedAspectRatio=e,this.persistState()})}setDuration(e){(0,o.h5)(()=>{this.selectedDuration=e,this.persistState()})}setSize(e){(0,o.h5)(()=>{this.selectedSize=e,this.persistState()})}setStyle(e){(0,o.h5)(()=>{this.selectedStyle=e,this.persistState()})}async generateImageToVideo(){if(console.log("[VideoStore] generateImageToVideo called:",{uploadedImage:this.uploadedImage,format:this.selectedFormat,aspectRatio:this.selectedAspectRatio,duration:this.selectedDuration}),(0,o.h5)(()=>{this.error=null,this.rootStore.aiStore.clearPersistentError()}),!this.uploadedImage){console.log("[VideoStore] No uploaded image"),(0,o.h5)(()=>{this.error="Please upload an image first"});return}let e=this.rootStore.userStore?.user,t=e?e.instantCredits+e.dailyCredits+e.refCredits:0;if(console.log("[VideoStore] Credit check:",{totalCredits:t,creditCost:this.creditCost}),!e||t<this.creditCost){console.log("[VideoStore] Insufficient credits"),(0,o.h5)(()=>{this.error=`Insufficient credits. Need ${this.creditCost} credits.`});return}try{let e;if(console.log("[VideoStore] Starting video generation via socket..."),(0,o.h5)(()=>{this.generatedVideo=null,this.progress=null,this.isGenerating=!0,this.serverRequestId=null}),this.uploadedImage&&!((e=this.uploadedImage)&&(e.startsWith("http://")||e.startsWith("https://"))))throw console.error("[VideoStore] uploadedImage is not a valid URL:",this.uploadedImage?.substring(0,100)),Error("Image must be uploaded to S3 first. Please try uploading the image again.");let t={imageUrl:this.uploadedImage,aspectRatio:this.selectedAspectRatio,duration:this.selectedDuration,size:this.selectedSize,style:this.selectedStyle};console.log("[VideoStore] Sending socket message:",{type:"imageToVideo",params:t});let r=this.rootStore.requester.socketService;if(console.log("[VideoStore] Socket service available:",!!r),!r)throw Error("Socket service not available");console.log("[VideoStore] Calling sendMessage...");let i=crypto.randomUUID();(0,o.h5)(()=>{this.activeRequestId=i,this.serverRequestId=null,console.log("[VideoStore] Set activeRequestId:",{requestId:i,activeRequestId:this.activeRequestId,isGenerating:this.isGenerating}),this.persistState()}),console.log("[VideoStore] After runInAction, activeRequestId is:",this.activeRequestId),r.sendMessage("undress.zone",{type:"imageToVideo",params:t,requestId:i}).catch(e=>{console.log("[VideoStore] Socket sendMessage error:",{error:e,reason:e?.reason,message:e?.message,fullError:JSON.stringify(e)});let t="string"==typeof e?.reason?e.reason.toLowerCase():"",r="string"==typeof e?.message?e.message.toLowerCase():"",n=t.includes("timeout")||r.includes("timeout");t.includes("socket_disconnected")||t.includes("socket_connection_failed")||t.includes("connect")||r.includes("disconnected")||r.includes("connection failed")||e?.reason!=="empty_response"&&!n?(console.error("[VideoStore] Critical socket error:",e?.message||e?.reason||"Unknown","| Request ID:",this.activeRequestId),(0,o.h5)(()=>{this.error=this.getFriendlyErrorMessage(e?.reason,e?.message||"Failed to send generation request"),this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null}),this.persistState(),Promise.resolve().then(s.bind(s,1889)).then(({persistenceService:e})=>{e.clearActiveGeneration(),console.log("[VideoStore] Cleared active generation from persistence after socket error")}).catch(e=>console.error("[VideoStore] Failed to clear persistence:",e)),s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:e})=>{e.remove(i),console.log("[VideoStore] Removed from PendingGenerationsService after socket error")}).catch(e=>console.error("[VideoStore] Failed to clear pending generation:",e))):console.log("[VideoStore] Ignoring non-critical socket error, keeping activeRequestId:",{activeRequestId:this.activeRequestId,reason:e?.reason,message:e?.message})}),console.log("[VideoStore] Message sent, waiting for events...")}catch(e){console.error("[VideoStore] Generation error:",{error:e,message:e?.message,stack:e?.stack,type:typeof e,stringified:JSON.stringify(e)}),(0,o.h5)(()=>{let t=e?.message||e?.toString()||"Failed to start video generation";this.error=this.getFriendlyErrorMessage(e?.reason,t),this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null}),this.persistState(),Promise.resolve().then(s.bind(s,1889)).then(({persistenceService:e})=>{e.clearActiveGeneration(),console.log("[VideoStore] Cleared active generation from persistence after exception")}).catch(e=>console.error("[VideoStore] Failed to clear persistence:",e))}}async generateTextToVideo(){if((0,o.h5)(()=>{this.error=null,this.rootStore.aiStore.clearPersistentError()}),!this.textPrompt.trim())return void(0,o.h5)(()=>{this.error="Please enter a text prompt"});let e=this.rootStore.userStore?.user,t=e?e.instantCredits+e.dailyCredits+e.refCredits:0;if(!e||t<this.creditCost)return void(0,o.h5)(()=>{this.error=`Insufficient credits. Need ${this.creditCost} credits.`});try{(0,o.h5)(()=>{this.generatedVideo=null,this.progress=null});let e=this.rootStore.requester.socketService,t=await e.sendMessage("generate",{type:"textToVideo",params:{prompt:this.textPrompt,format:this.selectedFormat,aspectRatio:this.selectedAspectRatio,duration:this.selectedDuration}});(0,o.h5)(()=>{this.activeRequestId=t.requestId})}catch(e){(0,o.h5)(()=>{this.error=e.message||"Failed to start video generation",this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null}),this.persistState(),Promise.resolve().then(s.bind(s,1889)).then(({persistenceService:e})=>{e.clearActiveGeneration(),console.log("[VideoStore] Cleared active generation from persistence after text-to-video error")}).catch(e=>console.error("[VideoStore] Failed to clear persistence:",e))}}clearError(){(0,o.h5)(()=>{this.error=null})}reset(){(0,o.h5)(()=>{this.uploadedImage=null,this.textPrompt="",this.selectedFormat="mp4",this.selectedAspectRatio="16:9",this.selectedDuration=3,this.selectedSize="512x512",this.selectedStyle="blowjob",this.activeRequestId=null,this.serverRequestId=null,this.generatedVideo=null,this.progress=null,this.isGenerating=!1,this.error=null,this.queuePosition=null,this.canCancel=!1,this.isCancelling=!1}),sessionStorage.removeItem("videoStore"),console.log("[VideoStore] State cleared from sessionStorage")}clearResult(){(0,o.h5)(()=>{console.log("[VideoStore] clearResult called",{hasUploadedImage:!!this.uploadedImage,uploadedImageLength:this.uploadedImage?.length,hasRootStore:!!this.rootStore,aiStoreCurrentImage:!!this.rootStore?.aiStore.currentImage,aiStoreUploadedImage:!!this.rootStore?.aiStore.uploadedImage}),this.clearProgressWatchdog(),this.generatedVideo=null,this.progress=null,this.isGenerating=!1,this.error=null,this.activeRequestId=null,this.serverRequestId=null,this.queuePosition=null,this.canCancel=!1,this.isCancelling=!1;let e=this.uploadedImage||this.rootStore?.aiStore.uploadedImage||this.rootStore?.aiStore.currentImage;e&&this.rootStore?(console.log("[VideoStore] clearResult - syncing image to aiStore",{source:this.uploadedImage?"videoStore":"aiStore",imageLength:e.length}),this.rootStore.aiStore.currentImage=e,this.rootStore.aiStore.uploadedImage=e,this.uploadedImage||(this.uploadedImage=e)):console.warn("[VideoStore] clearResult - No uploaded image found in any store!"),this.persistState()})}persistState(){try{let e={uploadedImage:this.uploadedImage,textPrompt:this.textPrompt,selectedFormat:this.selectedFormat,selectedAspectRatio:this.selectedAspectRatio,selectedDuration:this.selectedDuration,selectedSize:this.selectedSize,selectedStyle:this.selectedStyle,activeRequestId:this.activeRequestId,serverRequestId:this.serverRequestId,generatedVideo:this.generatedVideo,progress:this.progress,isGenerating:this.isGenerating,queuePosition:this.queuePosition,canCancel:this.canCancel,timestamp:Date.now()};sessionStorage.setItem("videoStore",JSON.stringify(e)),console.log("[VideoStore] State persisted to sessionStorage:",e)}catch(e){console.error("[VideoStore] Failed to persist state:",e)}}restoreState(){try{let e=sessionStorage.getItem("videoStore");if(!e)return void console.log("[VideoStore] No stored state found");let t=JSON.parse(e);if(Date.now()-(t.timestamp||0)>6e5){console.log("[VideoStore] Stored state is too old, clearing"),sessionStorage.removeItem("videoStore");return}console.log("[VideoStore] Restoring state from localStorage:",{hasUploadedImage:!!t.uploadedImage,uploadedImageType:t.uploadedImage?t.uploadedImage.startsWith("data:")?"base64":"url":"none",uploadedImageLength:t.uploadedImage?.length,uploadedImagePreview:t.uploadedImage?.substring(0,100),hasGeneratedVideo:!!t.generatedVideo,hasProgress:!!t.progress,isGenerating:t.isGenerating}),(0,o.h5)(()=>{if(t.uploadedImage&&(console.log("[VideoStore] Restoring uploadedImage:",t.uploadedImage.substring(0,100)),this.uploadedImage=t.uploadedImage),void 0!==t.textPrompt&&(this.textPrompt=t.textPrompt),t.selectedFormat&&(this.selectedFormat=t.selectedFormat),t.selectedAspectRatio&&(this.selectedAspectRatio=t.selectedAspectRatio),t.selectedDuration&&(this.selectedDuration=t.selectedDuration),t.selectedSize&&(this.selectedSize=t.selectedSize),t.selectedStyle&&(this.selectedStyle=t.selectedStyle),t.activeRequestId&&(this.activeRequestId=t.activeRequestId),t.serverRequestId&&(this.serverRequestId=t.serverRequestId),t.generatedVideo&&(this.generatedVideo=t.generatedVideo),t.progress&&(this.progress=t.progress),void 0!==t.queuePosition&&(this.queuePosition=t.queuePosition),void 0!==t.canCancel&&(this.canCancel=t.canCancel),t.isGenerating&&t.activeRequestId&&!t.generatedVideo){this.isGenerating=!0,console.log("[VideoStore] Restored active generation, checking backend status...",{activeRequestId:t.activeRequestId,serverRequestId:t.serverRequestId,progress:t.progress});let e=setTimeout(()=>{(0,o.h5)(()=>{if(this.isGenerating&&this.activeRequestId===t.activeRequestId){console.warn("[VideoStore] Failsafe timeout: No backend response for 15 seconds, clearing stuck state"),this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null,this.progress=null,this.queuePosition=null,this.canCancel=!1,this.error="Generation timed out. Please try again.",this.persistState();let e=this.rootStore.aiStore;if(e){console.log("[VideoStore] Clearing AIStore loading state after failsafe timeout");let t=e.asyncStatuses?.startStableJob;t&&e.setError(t),e.activeRequestId&&(e.activeRequestId=null,e.isRequestAccepted=!1)}Promise.resolve().then(s.bind(s,1889)).then(({persistenceService:e})=>{e.clearActiveGeneration(),console.log("[VideoStore] Cleared active generation from persistence")}).catch(e=>console.error("[VideoStore] Failed to clear persistence:",e)),s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:e})=>{e.remove(t.activeRequestId),console.log("[VideoStore] Removed from PendingGenerationsService")}).catch(e=>console.error("[VideoStore] Failed to clear pending generation:",e))}})},15e3);this.failsafeTimeoutId=e,this.verifyGenerationStatus(t.activeRequestId,t.serverRequestId)}else t.generatedVideo&&console.log("[VideoStore] Video already generated, skipping loading state restoration")}),console.log("[VideoStore] State restored successfully")}catch(e){console.error("[VideoStore] Failed to restore state:",e),localStorage.removeItem("videoStore")}}async verifyGenerationStatus(e,t,r=0){try{console.log("[VideoStore] Verifying generation status with backend...",{clientRequestId:e,serverRequestId:t,retryCount:r});let i=this.rootStore.requester?.socketService;if(!i){if(r<3){console.log("[VideoStore] Socket service not available, retrying in 500ms...",{retryCount:r}),setTimeout(()=>{this.verifyGenerationStatus(e,t,r+1)},500);return}console.warn("[VideoStore] Socket service not available after retries, clearing generation state"),(0,o.h5)(()=>{this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null,this.progress=null});return}console.log("[VideoStore] Requesting status via recovery:check"),i.emit("recovery:check",{pendingGenerations:[{requestId:e,...t?{externalRequestId:t}:{}}]}),this.verificationTimeoutId=setTimeout(()=>{(0,o.h5)(()=>{if(this.isGenerating&&this.activeRequestId===e){console.warn("[VideoStore] No response from backend status check after 10 seconds, clearing stale generation state"),this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null,this.progress=null,this.queuePosition=null,this.verificationTimeoutId=null,this.error="Generation timed out. Please try again.",this.persistState();let t=this.rootStore.aiStore;if(t){console.log("[VideoStore] Clearing AIStore loading state for stale generation");let e=t.asyncStatuses?.startStableJob;e&&t.setError(e),t.activeRequestId&&(t.activeRequestId=null,t.isRequestAccepted=!1)}s.e(2352).then(s.bind(s,52352)).then(({PendingGenerationsService:t})=>{t.remove(e),console.log("[VideoStore] Removed from PendingGenerationsService")}).catch(e=>console.error("[VideoStore] Failed to clear pending generation:",e))}})},1e4)}catch(t){console.error("[VideoStore] Failed to verify generation status:",t),(0,o.h5)(()=>{this.isGenerating=!1,this.activeRequestId=null,this.serverRequestId=null,this.progress=null});let e=this.rootStore.aiStore;if(e){console.log("[VideoStore] Clearing AIStore loading state after verification error");let t=e.asyncStatuses?.startStableJob;t&&e.setError(t),e.activeRequestId&&(e.activeRequestId=null,e.isRequestAccepted=!1)}}}updateQueueStatus(e,t){(0,o.h5)(()=>{this.queuePosition=e,this.canCancel=t})}clearStuckState(){console.log("[VideoStore] Manually clearing stuck generation state"),this.verificationTimeoutId&&(clearTimeout(this.verificationTimeoutId),this.verificationTimeoutId=null),(0,o.h5)(()=>{this.isGenerating=!1,this.isCancelling=!1,this.activeRequestId=null,this.serverRequestId=null,this.progress=null,this.queuePosition=null,this.canCancel=!1,this.error=null,this.persistState()});let e=this.rootStore.aiStore;if(e){console.log("[VideoStore] Clearing AIStore loading state");let t=e.asyncStatuses?.startStableJob;t&&e.setSuccess(t),(0,o.h5)(()=>{e.activeRequestId&&(e.activeRequestId=null,e.isRequestAccepted=!1)}),Promise.resolve().then(s.bind(s,1889)).then(({persistenceService:e})=>{e.clearActiveGeneration(),console.log("[VideoStore] Cleared active generation from persistence")}).catch(e=>console.error("[VideoStore] Failed to clear persistence:",e))}}async cancelGeneration(){if(!this.activeRequestId||this.isCancelling||!this.canCancel)return;let e=this.rootStore.requester?.socketService;e?((0,o.h5)(()=>{this.isCancelling=!0,this.error=null}),console.log("[VideoStore] Sending cancel request via socket:",{requestId:this.activeRequestId,queuePosition:this.queuePosition,canCancel:this.canCancel}),e.emit("video.cancel",{requestId:this.activeRequestId}).then(()=>{console.log("[VideoStore] Cancel request emitted successfully",{requestId:this.activeRequestId})}).catch(e=>{console.error("[VideoStore] Cancel socket error:",e),(0,o.h5)(()=>{this.error=this.getFriendlyErrorMessage(e?.reason,e?.message||"Failed to cancel generation"),this.isCancelling=!1}),this.activeRequestId&&this.scheduleProgressWatchdog(this.activeRequestId)})):(0,o.h5)(()=>{this.error=this.getFriendlyErrorMessage("socket_unavailable","Unable to connect. Please refresh and try again.")})}clearProgressWatchdog(){}scheduleProgressWatchdog(e){}get creditCost(){return(0,V.j4)(this.selectedDuration)}get displayRequestId(){return this.serverRequestId??this.activeRequestId}get canGenerateImage(){let e=this.rootStore.userStore?.user,t=e?e.instantCredits+e.dailyCredits+e.refCredits:0,s=t>=this.creditCost,r=!!this.uploadedImage,o=!!(s&&r&&!this.isGenerating);return console.log("[VideoStore] canGenerateImage:",{hasCredits:s,totalCredits:t,instantCredits:e?.instantCredits,dailyCredits:e?.dailyCredits,refCredits:e?.refCredits,creditCost:this.creditCost,hasImage:r,uploadedImage:this.uploadedImage,isGenerating:this.isGenerating,result:o}),o}get canGenerateText(){let e=this.rootStore.userStore?.user,t=(e?e.instantCredits+e.dailyCredits+e.refCredits:0)>=this.creditCost,s=this.textPrompt.trim().length>0;return!!(t&&s&&!this.isGenerating)}normalizeQueuePosition(e){if(null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e){let t=Number(e);return Number.isFinite(t)?t:null}return null}getFriendlyErrorMessage(e,t){return(t?.toLowerCase()??"").includes("insufficient credits")?"Insufficient credits. Please add more credits.":"Error occurred. Please try again."}}class _{constructor(){this.getInitialData=()=>{this.userStore.getMe(!0)},this.initSocket=()=>{this.authStore.inintSocket(),this.userStore.subscribeToMeUpdates(),this.requester.socketService.subscribe("requestAccepted",e=>{this.aiStore.handleRequestAccepted(e),this.videoStore.handleRequestAccepted(e)}),this.requester.socketService.subscribe("progress",e=>{this.aiStore.handleProgress(e),this.videoStore.handleProgress(e)}),this.requester.socketService.subscribe("result",e=>{this.aiStore.handleComplete(e),this.videoStore.handleComplete(e)}),this.requester.socketService.subscribe("error",e=>{this.aiStore.handleError(e),this.videoStore.handleError(e)}),this.requester.socketService.subscribe("cancelled",e=>{this.videoStore.handleCancelled(e)})},this.asyncStore=new n,this.requester=new b,this.modalsStore=new T,this.localStorageStore=new N,this.aiStore=new k(this),this.authStore=new F(this),this.routeStore=new L(this),this.userStore=new G(this),this.localizationStore=new B(this),this.promoCodeStore=new U(this),this.videoStore=new D(this)}}let X="undress";class N{get storage(){try{return window.localStorage}catch(e){return console.warn("LocalStorage unavailable:",e),null}}setItem(e,t){let s=this.storage;if(!s)return;let r=encodeURIComponent(`${X}.${e}`);s.setItem(`${r}`,`${t}`)}getItem(e){let t=this.storage;if(!t)return null;let s=encodeURIComponent(`${X}.${e}`),r=t.getItem(`${s}`);return r||null}removeItem(e){let t=this.storage;if(!t)return;let s=encodeURIComponent(`${X}.${e}`);t.removeItem(`${s}`)}}var z=s(27866),H=s.n(z),W=s(67262),O=s(14234);let j="en-US",K={[j]:"en","uk-UA":W},$={[j]:"en","uk-UA":"uk"};class B extends a{constructor(e){super(e),this.defaultLocale=j,this.currentLocale="en-US",this.loadLocaleFile=async(e,t=O.xU)=>s(82114)(`./${e}/${t}.json`),(0,o.Gn)(this,{defaultLocale:o.sH,currentLocale:o.sH,adapterLocale:o.EW,changeLanguage:o.XI.bound,setLanguage:o.XI.bound}),this.changeLanguage()}get adapterLocale(){return($[this.currentLocale]||$[j]).toLowerCase()}async changeLanguage(e=this.defaultLocale){try{if(!O.MR.hasResourceBundle(e,O.xU)){let{default:t}=await this.loadLocaleFile(e);await O.MR.addResourceBundle(e,O.xU,t,!0,!0)}await O.MR.changeLanguage(e)}catch(e){console.error(e)}finally{this.setLanguage(e)}}setLanguage(e){this.currentLocale=e;let t=K[e]||j;H().locale(t)}}let J=(0,r.createContext)({rootStore:new _}),Y=()=>(0,r.useContext)(J)}}]);